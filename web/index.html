<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Dominiate</title>
  <link rel="stylesheet" href="libs/bootstrap-mod.css">
  <link rel="stylesheet" href="dominiate.css">
</head>
<body>

<div id="masthead">
  <h1>dominiate</h1>
  <h2 class="tagline">A simulator for Dominion strategies.</h2>
</div>

<div id="p1">
<h2>Player 1</h2>
<div class="status" id="status1"></div>
<pre id="editor-left"># A pure money strategy.
{
  name: 'BigMoney'
  gainPriority: (state) -&gt; [
    "Colony" if state.current.countInDeck("Platinum") &gt; 0
    "Province" if state.countInSupply("Colony") &lt;= 6 \
               or state.countInSupply("Province") &lt;= 6
    "Duchy" if 0 &lt; state.gainsToEndGame() &lt;= 5
    "Estate" if 0 &lt; state.gainsToEndGame() &lt;= 2
    "Platinum"
    "Gold"
    "Silver"
    "Copper" if state.gainsToEndGame() &lt;= 3
    null
  ]
}
</pre>
</div>

<div id="p2">
<h2>Player 2</h2>
<div class="status" id="status2"></div>
<pre id="editor-right"># Buys random cards (of the highest cost available) like a noob.
{
  name: 'SillyAI'
  gainPriority: (state) -&gt;
    cards = []
    for card, count of state.supply
      if state.cardInfo[card].cost &gt; 0
        cards.push(card)
    effectiveCost = (card) -&gt;
      [coins, potions] = state.cardInfo[card].getCost(state)
      coins + potions*2 + Math.random()

    cards.sort( (c1, c2) -&gt;
      effectiveCost(c2) - effectiveCost(c1)
    )
    cards
}</pre>
</div>
<div id="layoutSeparator"></div>
<form id="gameControls">
  <ul class="inputs-list">
    <li>
      <label>
        <input type="checkbox" name="optionsCheckboxes" value="option1"
        checked="checked" />
        <span>Randomize player order</span>
      </label>
    </li>
    <li>
      <label>
        <input type="checkbox" name="optionsCheckboxes" value="option1"
        checked="checked" />
        <span>Include Colony and Platinum</span>
      </label>
    </li>
  </ul>
  <p id="actionButtons">
    <a id="playButton" href="#playButton" class="btn success">
      Play single game
    </a>
  </p>
</form>

<div id="matchResults">
<h2>Results</h2>
Results over multiple games will go here.
</div>

<pre id="gameLog">
</pre>

<script src="libs/ace/src/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="libs/ace/src/theme-dawn.js" type="text/javascript" charset="utf-8"></script>
<script src="libs/ace/src/mode-coffee.js" type="text/javascript" charset="utf-8"></script>
<script src="libs/coffee-script.js" type="text/javascript" charset="utf-8"></script>
<script src="libs/jquery-1.6.3.min.js" type="text/javascript" charset="utf-8"></script>
<script src="libs/zeroTimeout.js" type="text/javascript" charset="utf-8"></script>
<script src="playWeb.js" type="text/javascript" charset="utf-8"></script>

<script type="text/coffeescript">
scrollToBottom = (elt) ->
  elt.prop({ scrollTop: elt.prop("scrollHeight") })

$ = jQuery
$ ->
  window.editors = []
  for box in ["editor-left", "editor-right"]
    editor = ace.edit(box)
    editor.setTheme("ace/theme/dawn")
      
    JavaScriptMode = require("ace/mode/coffee").Mode;
    editor.getSession().setMode(new JavaScriptMode())
    
    editor.setShowPrintMargin(false)
    window.editors.push(editor)
 
  leftEd = window.editors[0].getSession()
  rightEd = window.editors[1].getSession()

  singleGameResult = (state) ->
    result = state.getWinners().toString() + " wins!"
    $('#gameLog').append(result)
    scrollToBottom($('#gameLog'))

  log = (text) -> $('#gameLog').append(text+'\n')

  $('#playButton').click (event) ->
    scripts = [leftEd.getValue(), rightEd.getValue()]
    $('.status').text('')
    errorHandlers = []
    errorHandlers.push (error) => $('#status1').html('<div class="error">'+error.message+'</div>')
    errorHandlers.push (error) => $('#status2').html('<div class="error">'+error.message+'</div>')
    compileAndPlay(scripts, log, singleGameResult, errorHandlers)

</script>

</body>
</html>
