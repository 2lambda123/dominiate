<!DOCTYPE html>  <html> <head>   <title>basicAI.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="basicAI.html">                 basicAI.coffee               </a>                                           <a class="source" href="cards.html">                 cards.coffee               </a>                                           <a class="source" href="compileStrategies.html">                 compileStrategies.coffee               </a>                                           <a class="source" href="gameState.html">                 gameState.coffee               </a>                                           <a class="source" href="heuristics.html">                 heuristics.coffee               </a>                                           <a class="source" href="play.html">                 play.coffee               </a>                                           <a class="source" href="playWeb.html">                 playWeb.coffee               </a>                                           <a class="source" href="testSimulation.html">                 testSimulation.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               basicAI.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>The Basic AI</h2>

<p>This class defines a rule-based AI of the kind that is popular
for evaluating Dominion strategies. It can be subclassed -- or simply
have its methods overwritten on an instance -- to play new strategies.</p>

<p>Every time the player needs to make a meaningful decision, a method called
<code>chooseX</code> (for some X) will be called on the AI, which can examine the game
state and make a decision accordingly.</p>

<p>In any case that is not a simple yes/no decision, the method will be 
given a list of choices. It will first check a method called <code>xPriority</code>,
which takes in the state and returns an ordered list of choices.
The player will make the first valid choice in that list. Choices are
skipped when they have an "if" clause that fails.</p>

<p>If the priority list doesn't choose anything, or if there is no priority
function, it will consult the <code>xValue</code> method instead, which takes in
a specific choice and assigns it a numerical value.</p>

<p>Priority functions are usually easier to define than value functions, but
value functions can easily cover every possible case.</p>

<p>The BasicAI has a default decision function for every decision, so
every AI that derives from it will have <em>some</em> way to decide what to do in
any situation. However, when defining an AI, you will often want to override
some of these decision functions.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">BasicAI</span>
  <span class="nv">name: </span><span class="s1">&#39;Basic AI&#39;</span>
  <span class="nv">author: </span><span class="s1">&#39;rspeer&#39;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Referring to <code>state.current</code> to find information about one's own state is
not always safe! Some of these decisions may be made during other players'
turns. In those cases, what we want is <code>this.myPlayer(state)</code>.</p>

<p>This is passed in as an argument <code>my</code> to the decision functions, because
it's convenient and it creates nice idioms such as <code>my.hand</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">myPlayer: </span><span class="nf">(state) -&gt;</span>
    <span class="k">for</span> <span class="nx">player</span> <span class="k">in</span> <span class="nx">state</span><span class="p">.</span><span class="nx">players</span>
      <span class="k">if</span> <span class="nx">player</span><span class="p">.</span><span class="nx">ai</span> <span class="o">is</span> <span class="k">this</span>
        <span class="k">return</span> <span class="nx">player</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;#{this} is being asked to make a decision, but isn&#39;t playing the game...?&quot;</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Decision-making machinery</h2>

<p>Make the AI's preferred choice, first by checking its explicit priority
list. If no valid choices are on the list, ask the value function instead.</p>

<p>The priority function returns an ordered list of choices it will want to
make when they are available. If 'null' is on the priority list, that
represents an explicit preference to choose "none of the above" when it's
an option.</p>

<p>The value list assigns a numerical value to every possible choice. 'null'
automatically has a value of 0. Here you can represent actions you will
only take when forced to, by giving them negative values.</p>

<p>If a choice should be made entirely using the value function, make the
priority function return an empty list.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">choose: </span><span class="nf">(type, state, choices) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Are there no choices? We follow the rule that makes the null choice
available in that situation, and choose it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>First, try the priority function. If the priority function reaches
the end of its list, it is treated as "none of the above".</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">priorityfunc = </span><span class="k">this</span><span class="p">[</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;Priority&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">priorityfunc</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Construct an object with the choices as keys, so we can look them
up quickly.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">choiceSet = </span><span class="p">{}</span>
      <span class="k">for</span> <span class="nx">choice</span> <span class="k">in</span> <span class="nx">choices</span>
        <span class="nx">choiceSet</span><span class="p">[</span><span class="nx">choice</span><span class="p">]</span> <span class="o">=</span> <span class="nx">choice</span>

      <span class="nv">nullable = </span><span class="kc">null</span> <span class="k">in</span> <span class="nx">choices</span>
      </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Get the priority list.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">priority = </span><span class="nx">priorityfunc</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Now look up all the preferences in that list. The moment we encounter
a valid choice, we can return it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="nx">preference</span> <span class="k">in</span> <span class="nx">priority</span>
        <span class="k">if</span> <span class="nx">preference</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">and</span> <span class="nx">nullable</span>
          <span class="k">return</span> <span class="kc">null</span>
        <span class="k">if</span> <span class="nx">choiceSet</span><span class="p">[</span><span class="nx">preference</span><span class="p">]</span><span class="o">?</span>
          <span class="k">return</span> <span class="nx">choiceSet</span><span class="p">[</span><span class="nx">preference</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>The priority list doesn't want any of these choices (perhaps because
it doesn't exist). Now try the value function.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">bestChoice = </span><span class="kc">null</span>
    <span class="nv">bestValue = </span><span class="o">-</span><span class="kc">Infinity</span>
  
    <span class="k">for</span> <span class="nx">choice</span> <span class="k">in</span> <span class="nx">choices</span>
      <span class="nv">value = </span><span class="k">this</span><span class="p">.</span><span class="nx">getChoiceValue</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">bestValue</span>
        <span class="nv">bestValue = </span><span class="nx">value</span>
        <span class="nv">bestChoice = </span><span class="nx">choice</span>
      </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>If we got a valid choice, return it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">bestChoice</span> <span class="k">in</span> <span class="nx">choices</span>
      <span class="k">return</span> <span class="nx">bestChoice</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>If we get here, the AI probably wants to choose none of the above.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="kc">null</span> <span class="k">in</span> <span class="nx">choices</span>
      <span class="k">return</span> <span class="kc">null</span>

    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;#{this} somehow failed to make a choice&quot;</span><span class="p">)</span>
  
  <span class="nv">getChoiceValue: </span><span class="nf">(type, state, choice, my) -&gt;</span>
    <span class="k">if</span> <span class="nx">choice</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">or</span> <span class="nx">choice</span> <span class="o">is</span> <span class="kc">no</span>
      <span class="k">return</span> <span class="mi">0</span>

    <span class="nv">specificValueFunc = </span><span class="k">this</span><span class="p">[</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">specificValueFunc</span><span class="o">?</span>
      <span class="nv">result = </span><span class="nx">specificValueFunc</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">result</span> <span class="o">is</span> <span class="kc">undefined</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;#{this} has an undefined #{type} value for #{choice}&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">result</span> <span class="o">isnt</span> <span class="kc">null</span>
        <span class="k">return</span> <span class="nx">result</span>

    <span class="nv">defaultValueFunc = </span><span class="nx">choice</span><span class="p">[</span><span class="s1">&#39;ai_&#39;</span><span class="o">+</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">defaultValueFunc</span><span class="o">?</span>
      <span class="nv">result = </span><span class="nx">defaultValueFunc</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">choice</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">result</span> <span class="o">is</span> <span class="kc">undefined</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;#{this} has an undefined #{type} value for #{choice}&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">result</span> <span class="o">isnt</span> <span class="kc">null</span>
        <span class="k">return</span> <span class="nx">result</span>

    <span class="nx">state</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;#{this} doesn&#39;t know how to make a #{type} decision for #{choice}&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1000</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Sometimes we need to compare choices in a strictly numeric way. This takes
a particular choice for a particular choice type, and gets its numeric value.
If the value comes from a priority list, it will be 100 * (distance from end
of list).</p>

<p>So, for example, the default choiceToValue of discarding a Colony is 999, while
the choiceToValue of discarding an extra terminal is 1.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">choiceToValue: </span><span class="nf">(type, state, choice) -&gt;</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="nx">choice</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">or</span> <span class="nx">choice</span> <span class="o">is</span> <span class="kc">no</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">priorityfunc = </span><span class="k">this</span><span class="p">[</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;Priority&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">priorityfunc</span><span class="o">?</span>
      <span class="nv">priority = </span><span class="nx">priorityfunc</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">priority = </span><span class="p">[]</span>
    <span class="nv">index = </span><span class="nx">priority</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">choice</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">priority</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">index</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getChoiceValue</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
   </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h3>Backwards-compatible choices</h3>

<p>To avoid having to rewrite all the code at once, we support these functions
that pass <code>chooseAction</code> onto <code>choose('action')</code>, and so on.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseAction: </span><span class="nf">(state, choices) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;play&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span>
  <span class="nv">chooseTreasure: </span><span class="nf">(state, choices) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;play&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span>
  <span class="nv">chooseGain: </span><span class="nf">(state, choices) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;gain&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span>
  <span class="nv">chooseDiscard: </span><span class="nf">(state, choices) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span>
  <span class="nv">chooseTrash: </span><span class="nf">(state, choices) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;trash&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h2>Default strategies</h2>

<p>The default buying strategy is a form of Big Money that has, by now,
been beaten by the newer one in BigMoney.coffee.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">gainPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Colony&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Platinum&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s2">&quot;Province&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">countInSupply</span><span class="p">(</span><span class="s2">&quot;Colony&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">6</span>
    <span class="s2">&quot;Duchy&quot;</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">5</span>
    <span class="s2">&quot;Estate&quot;</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Platinum&quot;</span>
    <span class="s2">&quot;Gold&quot;</span>
    <span class="s2">&quot;Silver&quot;</span>
    <span class="s2">&quot;Copper&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">3</span>
  <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>gainValue covers cases where a strategy has to gain a card that isn't in
its priority list. The default is to favor more expensive cards,
particularly action and treasure cards.</p>

<p>It is important for all these values to be negative, to avoid giving defined
strategies cards they don't actually want.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">gainValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nx">card</span><span class="p">.</span><span class="nx">costPotion</span> <span class="o">+</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span> <span class="o">+</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">-</span> <span class="mi">20</span>
  </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>This used to be the default action-playing priority. Now the value of playing
a card is defined on the "ai_playValue" function of each card.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">old_actionPriority: </span><span class="nf">(state, my, skipMultipliers = false) -&gt;</span> 
    <span class="nv">wantsToTrash = </span><span class="k">this</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">countInHandCopper = </span><span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Copper&quot;</span><span class="p">)</span>
    <span class="nv">currentAction = </span><span class="nx">my</span><span class="p">.</span><span class="nx">getCurrentAction</span><span class="p">()</span>
    <span class="nv">multiplier = </span><span class="mi">1</span>
    <span class="k">if</span> <span class="nx">currentAction</span><span class="o">?</span><span class="p">.</span><span class="nx">isMultiplier</span>
      <span class="nv">multiplier = </span><span class="nx">currentAction</span><span class="p">.</span><span class="nx">multiplier</span>
    
    <span class="nv">wantsToPlayMultiplier = </span><span class="kc">false</span>
    <span class="nv">okayToPlayMultiplier = </span><span class="kc">false</span>

    <span class="nx">unless</span> <span class="nx">skipMultipliers</span>
      <span class="nv">mults = </span><span class="p">(</span><span class="nx">card</span> <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span> <span class="k">when</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isMultiplier</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">mults</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>We've got a multiplier in hand. Figure out if we want to play it.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">mult = </span><span class="nx">mults</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nv">choices = </span><span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nx">choices</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">mult</span><span class="p">)</span>
        <span class="nx">choices</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Determine if it's better than nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">choice1 = </span><span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;multipliedAction&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">choice1</span> <span class="o">isnt</span> <span class="kc">null</span>
          <span class="nv">okayToPlayMultiplier = </span><span class="kc">true</span>
        </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Now add the "wait" option and see if we want to multiply an action
<em>right now</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
          <span class="nx">choices</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;wait&quot;</span><span class="p">)</span>
        <span class="nv">choice = </span><span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;multipliedAction&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">choice</span> <span class="o">!=</span> <span class="s2">&quot;wait&quot;</span>
          <span class="nv">wantsToPlayMultiplier = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Priority 1: cards that succeed if we play them now, and might
not if we play them later. (950-999)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="s2">&quot;Menagerie&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">menagerieDraws</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="s2">&quot;Shanty Town&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">shantyTownDraws</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="s2">&quot;Tournament&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Province&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>2: Multipliers that do something sufficiently cool. (900-949)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Throne Room&quot;</span> <span class="k">if</span> <span class="nx">wantsToPlayMultiplier</span>
    <span class="s2">&quot;King&#39;s Court&quot;</span> <span class="k">if</span> <span class="nx">wantsToPlayMultiplier</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>3: cards that stack the deck. (850-899)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Lookout&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="o">or</span> <span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">.</span><span class="nx">Curse</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">draw</span>
    <span class="s2">&quot;Cartographer&quot;</span>
    <span class="s2">&quot;Bag of Gold&quot;</span>
    <span class="s2">&quot;Apothecary&quot;</span>
    <span class="s2">&quot;Scout&quot;</span>
    <span class="s2">&quot;Scrying Pool&quot;</span>
    <span class="s2">&quot;Spy&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>4: cards that give +2 actions. (800-849)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Trusty Steed&quot;</span>
    <span class="s2">&quot;Festival&quot;</span>
    <span class="s2">&quot;University&quot;</span>
    <span class="s2">&quot;Farming Village&quot;</span>
    <span class="s2">&quot;Bazaar&quot;</span>
    <span class="s2">&quot;Worker&#39;s Village&quot;</span>
    <span class="s2">&quot;City&quot;</span>
    <span class="s2">&quot;Walled Village&quot;</span>
    <span class="s2">&quot;Fishing Village&quot;</span>
    <span class="s2">&quot;Village&quot;</span>
    <span class="s2">&quot;Border Village&quot;</span>
    <span class="s2">&quot;Mining Village&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>5: cards that give +1 action and are almost always good. (700-800)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Grand Market&quot;</span>
    <span class="s2">&quot;Hunting Party&quot;</span>
    <span class="s2">&quot;Alchemist&quot;</span>
    <span class="s2">&quot;Laboratory&quot;</span>
    <span class="s2">&quot;Caravan&quot;</span>
    <span class="s2">&quot;Market&quot;</span>
    <span class="s2">&quot;Peddler&quot;</span>
    <span class="s2">&quot;Treasury&quot;</span>
    <span class="s2">&quot;Conspirator&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">inPlay</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">or</span> <span class="nx">multiplier</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Familiar&quot;</span>
    <span class="s2">&quot;Highway&quot;</span>
    <span class="s2">&quot;Scheme&quot;</span>
    <span class="s2">&quot;Wishing Well&quot;</span>
    <span class="s2">&quot;Golem&quot;</span>  <span class="c1"># seems to be reasonable to expect +1 action from Golem</span>
    <span class="s2">&quot;Great Hall&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">.</span><span class="nx">Crossroads</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span>
    <span class="s2">&quot;Spice Merchant&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">.</span><span class="nx">Copper</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span>
    <span class="s2">&quot;Stables&quot;</span> <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;stablesDiscard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">concat</span><span class="p">([</span><span class="kc">null</span><span class="p">]))</span>
    <span class="s2">&quot;Apprentice&quot;</span>
    <span class="s2">&quot;Pearl Diver&quot;</span>
    <span class="s2">&quot;Hamlet&quot;</span>
    <span class="s2">&quot;Lighthouse&quot;</span>
    <span class="s2">&quot;Haven&quot;</span>
    <span class="s2">&quot;Minion&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>6: terminal card-drawers, if we have actions to spare. (600-699)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">4</span>  <span class="c1"># 695</span>
    <span class="s2">&quot;Torturer&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Margrave&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Rabble&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Witch&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Ghost Ship&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Smithy&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Embassy&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">4</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">5</span> <span class="c1"># 620</span>
    <span class="s2">&quot;Council Room&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Courtyard&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="p">(</span><span class="nx">my</span><span class="p">.</span><span class="nx">discard</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">my</span><span class="p">.</span><span class="nx">draw</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span>
    <span class="s2">&quot;Oracle&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>7: Let's insert here an overly simplistic idea of how to play Crossroads.
Or if we don't have a Crossroads, play a Great Hall that we might otherwise
have played in priority level 5. (500-599)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Crossroads&quot;</span> <span class="nx">unless</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInPlay</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">.</span><span class="nx">Crossroads</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s2">&quot;Great Hall&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>8: card-cycling that might improve the hand. (400-499)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Upgrade&quot;</span> <span class="k">if</span> <span class="nx">wantsToTrash</span> <span class="o">&gt;=</span> <span class="nx">multiplier</span>
    <span class="s2">&quot;Oasis&quot;</span>
    <span class="s2">&quot;Pawn&quot;</span>
    <span class="s2">&quot;Warehouse&quot;</span>
    <span class="s2">&quot;Cellar&quot;</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">6</span>
    <span class="s2">&quot;Spice Merchant&quot;</span> <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;spiceMerchantTrash&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">concat</span><span class="p">([</span><span class="kc">null</span><span class="p">]))</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>9: non-terminal cards that don't succeed but at least give us something. (300-399)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;King&#39;s Court&quot;</span>
    <span class="s2">&quot;Throne Room&quot;</span> <span class="k">if</span> <span class="nx">okayToPlayMultiplier</span>
    <span class="s2">&quot;Tournament&quot;</span>
    <span class="s2">&quot;Menagerie&quot;</span>
    <span class="s2">&quot;Shanty Town&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&lt;</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>10: terminals. Of course, Nobles might be a non-terminal
if we decide we need the actions more than the cards. (100-299)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Crossroads&quot;</span>
    <span class="s2">&quot;Nobles&quot;</span>
    <span class="s2">&quot;Treasure Map&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Treasure Map&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Followers&quot;</span>
    <span class="s2">&quot;Mountebank&quot;</span> <span class="c1"># 290</span>
    <span class="s2">&quot;Witch&quot;</span>
    <span class="s2">&quot;Sea Hag&quot;</span>
    <span class="s2">&quot;Torturer&quot;</span>
    <span class="s2">&quot;Young Witch&quot;</span>
    <span class="s2">&quot;Tribute&quot;</span> <span class="c1"># after Cursers but before other terminals, there is probably a better spot for it</span>
    <span class="s2">&quot;Margrave&quot;</span> <span class="c1"># 280</span>
    <span class="s2">&quot;Goons&quot;</span>
    <span class="s2">&quot;Wharf&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Tactician needs a play condition, but I don't know what it would be.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Tactician&quot;</span> 
    <span class="s2">&quot;Masquerade&quot;</span> <span class="c1"># 270</span>
    <span class="s2">&quot;Vault&quot;</span> 
    <span class="s2">&quot;Ghost Ship&quot;</span>
    <span class="s2">&quot;Princess&quot;</span> 
    <span class="s2">&quot;Explorer&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Province&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">3</span>  <span class="c1"># 260</span>
    <span class="s2">&quot;Jester&quot;</span>
    <span class="s2">&quot;Militia&quot;</span>
    <span class="s2">&quot;Cutpurse&quot;</span>  <span class="c1"># 250</span>
    <span class="s2">&quot;Bridge&quot;</span>
    <span class="s2">&quot;Bishop&quot;</span>
    <span class="s2">&quot;Horse Traders&quot;</span>  <span class="c1"># 240</span>
    <span class="s2">&quot;Jack of All Trades&quot;</span>
    <span class="s2">&quot;Steward&quot;</span>
    <span class="s2">&quot;Moneylender&quot;</span> <span class="k">if</span> <span class="nx">countInHandCopper</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="c1"># 230</span>
    <span class="s2">&quot;Expand&quot;</span>
    <span class="s2">&quot;Remodel&quot;</span>  
    <span class="s2">&quot;Salvager&quot;</span> <span class="c1"># 220</span>
    <span class="s2">&quot;Mine&quot;</span>
    <span class="s2">&quot;Coppersmith&quot;</span> <span class="k">if</span> <span class="nx">countInHandCopper</span> <span class="o">&gt;=</span> <span class="mi">3</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">4</span>  <span class="c1"># 210</span>
    <span class="s2">&quot;Rabble&quot;</span>
    <span class="s2">&quot;Envoy&quot;</span>
    <span class="s2">&quot;Smithy&quot;</span>   <span class="c1"># 200</span>
    <span class="s2">&quot;Embassy&quot;</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">3</span>
    <span class="s2">&quot;Council Room&quot;</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">5</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">4</span>  <span class="c1"># 190</span>
    <span class="s2">&quot;Courtyard&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="nx">my</span><span class="p">.</span><span class="nx">discard</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">my</span><span class="p">.</span><span class="nx">draw</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s2">&quot;Merchant Ship&quot;</span>
    <span class="s2">&quot;Baron&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Estate&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="s2">&quot;Monument&quot;</span>
    <span class="s2">&quot;Oracle&quot;</span> <span class="c1"># 180</span>
    <span class="s2">&quot;Remake&quot;</span> <span class="k">if</span> <span class="nx">wantsToTrash</span> <span class="o">&gt;=</span> <span class="nx">multiplier</span> <span class="o">*</span> <span class="mi">2</span>   <span class="c1"># has a low priority so it&#39;ll mostly be played early in the game</span>
    <span class="s2">&quot;Adventurer&quot;</span>
    <span class="s2">&quot;Harvest&quot;</span>
    <span class="s2">&quot;Haggler&quot;</span> <span class="c1"># probably needs to make sure the gained card will be wanted; 170</span>
    <span class="s2">&quot;Mandarin&quot;</span>
    <span class="s2">&quot;Explorer&quot;</span>
    <span class="s2">&quot;Woodcutter&quot;</span>
    <span class="s2">&quot;Nomad Camp&quot;</span>
    <span class="s2">&quot;Chancellor&quot;</span> <span class="c1"># 160</span>
    <span class="s2">&quot;Counting House&quot;</span>
    <span class="s2">&quot;Coppersmith&quot;</span> <span class="k">if</span> <span class="nx">countInHandCopper</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Outpost&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">extraturn</span> <span class="o">==</span> <span class="kc">false</span>
    <span class="s2">&quot;Ambassador&quot;</span> <span class="k">if</span> <span class="nx">wantsToTrash</span> <span class="c1"># 150</span>
    <span class="s2">&quot;Trading Post&quot;</span> <span class="k">if</span> <span class="nx">wantsToTrash</span> <span class="o">+</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Silver&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">multiplier</span>
    <span class="s2">&quot;Chapel&quot;</span> <span class="k">if</span> <span class="nx">wantsToTrash</span>
    <span class="s2">&quot;Trader&quot;</span> <span class="k">if</span> <span class="nx">wantsToTrash</span> <span class="o">&gt;=</span> <span class="nx">multiplier</span>
    <span class="s2">&quot;Trade Route&quot;</span> <span class="k">if</span> <span class="nx">wantsToTrash</span> <span class="o">&gt;=</span> <span class="nx">multiplier</span>
    <span class="s2">&quot;Mint&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;mint&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">)</span> <span class="c1"># 140</span>
    <span class="s2">&quot;Secret Chamber&quot;</span>
    <span class="s2">&quot;Pirate Ship&quot;</span>
    <span class="s2">&quot;Noble Brigand&quot;</span>
    <span class="s2">&quot;Thief&quot;</span>
    <span class="s2">&quot;Island&quot;</span>  <span class="c1"># could be moved</span>
    <span class="s2">&quot;Fortune Teller&quot;</span> <span class="c1"># 130</span>
    <span class="s2">&quot;Bureaucrat&quot;</span>
    <span class="s2">&quot;Navigator&quot;</span>
    <span class="s2">&quot;Conspirator&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&lt;</span> <span class="mi">2</span>
    <span class="s2">&quot;Herbalist&quot;</span>
    <span class="s2">&quot;Moat&quot;</span>  <span class="c1"># 120</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">6</span>
    <span class="s2">&quot;Ironworks&quot;</span> <span class="c1"># should have higher priority if condition can see it will gain an Action card</span>
    <span class="s2">&quot;Workshop&quot;</span>
    <span class="s2">&quot;Smugglers&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">smugglerChoices</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="c1"># 110</span>
    <span class="s2">&quot;Feast&quot;</span>
    <span class="s2">&quot;Transmute&quot;</span> <span class="k">if</span> <span class="nx">wantsToTrash</span> <span class="o">&gt;=</span> <span class="nx">multiplier</span>
    <span class="s2">&quot;Coppersmith&quot;</span>
    <span class="s2">&quot;Saboteur&quot;</span>
    <span class="s2">&quot;Poor House&quot;</span>
    <span class="s2">&quot;Duchess&quot;</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">7</span>
    <span class="s2">&quot;Thief&quot;</span>  <span class="c1"># 100</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>11: cards that have become useless. Maybe they'll decrease
the cost of Peddler, trigger Conspirator, or something. (20-99)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Treasure Map&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Gold&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="o">and</span> <span class="nx">state</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Treasure Map&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="s2">&quot;Spice Merchant&quot;</span>
    <span class="s2">&quot;Shanty Town&quot;</span>
    <span class="s2">&quot;Stables&quot;</span> <span class="c1"># 50</span>
    <span class="s2">&quot;Chapel&quot;</span>
    <span class="s2">&quot;Library&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>12: Conspirator when +actions remain. (10)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Conspirator&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>"Baron"</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>At this point, we take no action if that choice is available.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Nope, something is forcing us to take an action.</p>

<p>Last priority: cards that are actively harmful to play at this point,
in order of increasing badness.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Baron&quot;</span>
    <span class="s2">&quot;Mint&quot;</span>
    <span class="s2">&quot;Watchtower&quot;</span>
    <span class="s2">&quot;Outpost&quot;</span>
    <span class="s2">&quot;Ambassador&quot;</span> <span class="c1"># -20</span>
    <span class="s2">&quot;Trader&quot;</span>
    <span class="s2">&quot;Transmute&quot;</span>
    <span class="s2">&quot;Trade Route&quot;</span>
    <span class="s2">&quot;Upgrade&quot;</span>  <span class="c1"># -30</span>
    <span class="s2">&quot;Remake&quot;</span>
    <span class="s2">&quot;Trading Post&quot;</span>
    <span class="s2">&quot;Treasure Map&quot;</span> <span class="c1"># -40</span>
    <span class="s2">&quot;Throne Room&quot;</span>
    <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p><code>multipliedActionPriority</code> is similar to <code>actionPriority</code>, but is used when
we have played a Throne Room or King's Court.</p>

<p>This list emphasizes cards that are really good when multiplied, especially
terminals when there are +actions left. At the end, it falls back on the
usual actionPriority list.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">old_multipliedActionPriority: </span><span class="nf">(state, my) -&gt;</span>
    <span class="p">[</span>
      <span class="s2">&quot;King&#39;s Court&quot;</span>  <span class="c1"># 2000</span>
      <span class="s2">&quot;Throne Room&quot;</span>   <span class="c1"># 1900</span>
      <span class="s2">&quot;Followers&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span> 
      <span class="s2">&quot;Grand Market&quot;</span>
      <span class="s2">&quot;Mountebank&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Witch&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">state</span><span class="p">.</span><span class="nx">countInSupply</span><span class="p">(</span><span class="s2">&quot;Curse&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
      <span class="s2">&quot;Sea Hag&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">state</span><span class="p">.</span><span class="nx">countInSupply</span><span class="p">(</span><span class="s2">&quot;Curse&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
      <span class="s2">&quot;Torturer&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">state</span><span class="p">.</span><span class="nx">countInSupply</span><span class="p">(</span><span class="s2">&quot;Curse&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
      <span class="s2">&quot;Young Witch&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">state</span><span class="p">.</span><span class="nx">countInSupply</span><span class="p">(</span><span class="s2">&quot;Curse&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
      <span class="s2">&quot;Crossroads&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInPlay</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">.</span><span class="nx">Crossroads</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>  <span class="c1"># 1800</span>
      <span class="s2">&quot;Scheme&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;King&#39;s Court&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Scrying Pool was here once, but I think you'd rather use it to <em>draw</em>
actions for your KC</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="s2">&quot;Wharf&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Bridge&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Minion&quot;</span>  <span class="c1"># 1700</span>
      <span class="s2">&quot;Ghost Ship&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Jester&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Horse Traders&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Mandarin&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Rabble&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># 1600</span>
      <span class="s2">&quot;Council Room&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Margrave&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Smithy&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Embassy&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Merchant Ship&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># 1500</span>
      <span class="s2">&quot;Pirate Ship&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Saboteur&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Noble Brigand&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Thief&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Monument&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># 1400</span>
      <span class="s2">&quot;Feast&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Conspirator&quot;</span>
      <span class="s2">&quot;Nobles&quot;</span>
      <span class="s2">&quot;Tribute&quot;</span>
      <span class="s2">&quot;Steward&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># 1300</span>
      <span class="s2">&quot;Goons&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Mine&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Masquerade&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Vault&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Oracle&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># 1200</span>
      <span class="s2">&quot;Cutpurse&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="s2">&quot;Coppersmith&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Copper&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
      <span class="s2">&quot;Ambassador&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="k">this</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>  <span class="c1"># 1100</span>
      <span class="s2">&quot;wait&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>We could add here some more cards that would be nice to play with a
multiplier. Nicer than Lookout, let's say, which appears pretty high
on the regular action priority list.</p>

<p>But at this point, just fall back on that priority list.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">old_actionPriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">,</span> <span class="nx">skipMultipliers</span><span class="o">=</span><span class="kc">true</span><span class="p">))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p><code>treasurePriority</code> determines what order to play treasures in.
Most of the order has no effect on gameplay. The
important part is that Bank and Horn of Plenty are last.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">treasurePriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Platinum&quot;</span>
    <span class="s2">&quot;Diadem&quot;</span>
    <span class="s2">&quot;Philosopher&#39;s Stone&quot;</span>
    <span class="s2">&quot;Gold&quot;</span>
    <span class="s2">&quot;Cache&quot;</span>
    <span class="s2">&quot;Hoard&quot;</span>
    <span class="s2">&quot;Royal Seal&quot;</span>
    <span class="s2">&quot;Harem&quot;</span>
    <span class="s2">&quot;Silver&quot;</span>
    <span class="s2">&quot;Fool&#39;s Gold&quot;</span>
    <span class="s2">&quot;Quarry&quot;</span>
    <span class="s2">&quot;Talisman&quot;</span>
    <span class="s2">&quot;Copper&quot;</span>
    <span class="s2">&quot;Potion&quot;</span>  <span class="c1"># 100 from here up</span>
    <span class="s2">&quot;Loan&quot;</span>    <span class="c1"># 90</span>
    <span class="s2">&quot;Venture&quot;</span> <span class="c1"># 80</span>
    <span class="s2">&quot;Ill-Gotten Gains&quot;</span>
    <span class="s2">&quot;Bank&quot;</span>
    <span class="s2">&quot;Horn of Plenty&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">numUniqueCardsInPlay</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">2</span>
  <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>The default <code>discardPriority</code> is tuned for Big Money where the decisions
are obvious. But many strategies would probably prefer a different
priority list, especially one that knows about action cards.</p>

<p>It doesn't understand
discarding cards to make Shanty Town or Menagerie work, for example.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">discardPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Tunnel&quot;</span>
    <span class="s2">&quot;Vineyard&quot;</span>
    <span class="s2">&quot;Colony&quot;</span>
    <span class="s2">&quot;Duke&quot;</span>
    <span class="s2">&quot;Duchy&quot;</span>
    <span class="s2">&quot;Fairgrounds&quot;</span>
    <span class="s2">&quot;Gardens&quot;</span>
    <span class="s2">&quot;Province&quot;</span>  <span class="c1"># Provinces are occasionally useful in hand</span>
    <span class="s2">&quot;Curse&quot;</span>
    <span class="s2">&quot;Estate&quot;</span>
  <span class="p">]</span>

  <span class="nv">discardValue: </span><span class="nf">(state, card, my) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>If we can discard excess actions, do so. Otherwise, discard the cheapest
cards. Victory cards would already have been discarded by discardPriority,
but if Tunnel fell through somehow we discard it here.</p>

<p>First, check to see if it's our turn. That changes whether we want to discard
actions.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">myTurn = </span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">current</span> <span class="o">==</span> <span class="nx">my</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">card</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;Tunnel&#39;</span>
      <span class="mi">25</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">and</span> <span class="nx">myTurn</span> <span class="o">and</span> <span class="o">\</span>
         <span class="p">((</span><span class="nx">card</span><span class="p">.</span><span class="nx">actions</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actionBalance</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
      <span class="mi">20</span> <span class="o">-</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span>
    <span class="k">else</span>
      <span class="mi">0</span> <span class="o">-</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span>

  <span class="nv">trashPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Curse&quot;</span>
    <span class="s2">&quot;Estate&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">4</span>
    <span class="s2">&quot;Copper&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">4</span>
    <span class="s2">&quot;Potion&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">turnsTaken</span> <span class="o">&gt;=</span> <span class="mi">10</span>
    <span class="s2">&quot;Estate&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2</span>
  <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>If we have to trash a card we don't want to, assign a value to each card.
By default, we want to trash the card with the lowest (cost + VP).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">trashValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="mi">0</span> <span class="o">-</span> <span class="nx">card</span><span class="p">.</span><span class="nx">vp</span> <span class="o">-</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Some cards give you a choice to discard an opponent's deck. These are
evaluated with <code>discardFromOpponentDeckValue</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">discardFromOpponentDeckValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="k">if</span> <span class="nx">card</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;Tunnel&#39;</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">2000</span>
    <span class="k">else</span> <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span><span class="p">)</span> <span class="o">and</span> <span class="o">not</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span><span class="p">)</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">10</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="nx">card</span><span class="p">.</span><span class="nx">coins</span> <span class="o">+</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAttack</span>  </pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p><code>discardHandValue</code> decides whether to discard an entire hand of cards.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">discardHandValue: </span><span class="nf">(state, hand, my, nCards = 5) -&gt;</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="nx">hand</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="nv">deck = </span><span class="nx">my</span><span class="p">.</span><span class="nx">discard</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">my</span><span class="p">.</span><span class="nx">draw</span><span class="p">)</span>
    <span class="nv">total = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="mi">5</span><span class="p">]</span>
      <span class="nx">shuffle</span><span class="p">(</span><span class="nx">deck</span><span class="p">)</span>
      <span class="nv">randomHand = </span><span class="nx">deck</span><span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nCards</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>If a random hand from this deck is better, discard this hand.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">total</span> <span class="o">+=</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">compareByDiscarding</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">randomHand</span><span class="p">,</span> <span class="nx">hand</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">total</span>
    </pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Prefer to gain action and treasure cards on the deck, assuming we want
them at all. Give other cards a value of -1 so that <code>null</code> is a better
choice.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">gainOnDeckValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">or</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">getChoiceValue</span><span class="p">(</span><span class="s1">&#39;gain&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="o">-</span><span class="mi">1</span>
  </pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Changed Priorities for putting cards back on deck.  Only works well for putting back 1 card, and for 1 buy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">putOnDeckPriority: </span><span class="nf">(state, my) -&gt;</span> </pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Make a priority order of:</p>

<ol>
<li>Actions we can't or don't intend to play, from best to worst</li>
<li>Treasures we can afford to put back</li>
<li>Junk cards</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>1) Actions</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">actions = </span><span class="p">(</span><span class="nx">card</span> <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span> <span class="k">when</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span><span class="p">)</span>
    <span class="nv">getChoiceValue = </span><span class="k">this</span><span class="p">.</span><span class="nx">getChoiceValue</span>
    <span class="nv">byPlayValue = </span><span class="nf">(x, y) -&gt;</span>
      <span class="nx">getChoiceValue</span><span class="p">(</span><span class="s1">&#39;play&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="o">-</span> <span class="nx">getChoiceValue</span><span class="p">(</span><span class="s1">&#39;play&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>

    <span class="nx">actions</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">byPlayValue</span><span class="p">)</span>
    <span class="nv">putBack = </span><span class="nx">actions</span><span class="p">[</span><span class="nx">my</span><span class="p">.</span><span class="nx">countPlayableTerminals</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">...]</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>2) Put back as much money as you can</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">putBack</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Get a list of all distinct treasures in hand, in order.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">treasures = </span><span class="p">[]</span>
      <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="p">(</span><span class="nx">card</span> <span class="k">in</span> <span class="nx">treasures</span><span class="p">))</span>
          <span class="nx">treasures</span><span class="p">.</span><span class="nx">push</span> <span class="nx">card</span>
      <span class="nx">treasures</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span> <span class="nf">(x, y) -&gt;</span> <span class="nx">y</span><span class="p">.</span><span class="nx">coins</span> <span class="o">-</span> <span class="nx">x</span><span class="p">.</span><span class="nx">coins</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Get the margin of how much money we're willing to discard.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">margin = </span><span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">coinLossMargin</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Find the treasure cards worth less than that.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">treasures</span>
        <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">coinsDueToCard</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nx">margin</span>
          <span class="nx">putBack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">card</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Don't put back last Potion if Alchemists are in play</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInPlay</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">[</span><span class="s2">&quot;Alchemist&quot;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span>
        <span class="k">if</span> <span class="s2">&quot;Potion&quot;</span> <span class="k">in</span> <span class="nx">putBack</span>
          <span class="nx">putBack</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">[</span><span class="s2">&quot;Potion&quot;</span><span class="p">])</span>
    </pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>3) Put back the worst card (take priority for discard)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">putBack</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="nv">putBack = </span><span class="p">[</span><span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">)]</span>

    <span class="nx">putBack</span>
  
  <span class="nv">putOnDeckValue: </span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">discardValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>  
  </pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>How much does the AI want to discard its deck right now (for Chancellor)?
Here, we decide to reshuffle (returning a reshuffleValue over 0) when most
of the non-Action, non-Treasure cards are in the draw pile, or when there
are no such cards in the deck.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">reshuffleValue: </span><span class="nf">(state, choice, my) -&gt;</span>
    <span class="nv">junkToDraw = </span><span class="mi">0</span>
    <span class="nv">totalJunk = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">draw</span>
      <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">or</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span><span class="p">)</span>
        <span class="nx">junkToDraw</span><span class="o">++</span>
    <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getDeck</span><span class="p">()</span>
      <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">or</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span><span class="p">)</span>
        <span class="nx">totalJunk</span><span class="o">++</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nx">totalJunk</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">proportion = </span><span class="nx">junkToDraw</span><span class="err">/totalJunk</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">proportion</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Choose opponent treasure to trash; go by the card's base cost.
Diadems are comparable to the cost-5 treasures.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">trashOppTreasureValue: </span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="k">if</span> <span class="nx">card</span> <span class="o">is</span> <span class="s1">&#39;Diadem&#39;</span>
      <span class="k">return</span> <span class="mi">5</span>
    <span class="k">return</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span>    </pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <h3>Decisions for particular cards</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p><code>ambassadorPriority</code> chooses a card to Ambassador and how many of it to
return.</p>

<p>These choices may look odd: remember that choices are evaluated as strings.
So if we return lists, they won't match any of the choices. We need to
return their joined string versions.</p>

<p>This is a moderately acceptable way to deal with the fact that, in
JavaScript, lists are never "equal" to other lists anyway.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ambassadorPriority: </span><span class="nf">(state, my) -&gt;</span>
    <span class="p">[</span>
      <span class="s2">&quot;[Curse, 2]&quot;</span>
      <span class="s2">&quot;[Curse, 1]&quot;</span>
      <span class="s2">&quot;[Curse, 0]&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Handle a silly case:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="s2">&quot;[Ambassador, 2]&quot;</span>
      <span class="s2">&quot;[Estate, 2]&quot;</span>
      <span class="s2">&quot;[Estate, 1]&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Make sure we have at least $5 in the deck, including if we buy a Silver.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="s2">&quot;[Copper, 2]&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span>
      <span class="s2">&quot;[Copper, 2]&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span>
      <span class="s2">&quot;[Copper, 2]&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">7</span>
      <span class="s2">&quot;[Copper, 1]&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">4</span>
      <span class="s2">&quot;[Copper, 1]&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">4</span>
      <span class="s2">&quot;[Estate, 0]&quot;</span>
      <span class="s2">&quot;[Copper, 0]&quot;</span>
      <span class="s2">&quot;[Potion, 2]&quot;</span>
      <span class="s2">&quot;[Potion, 1]&quot;</span>
      <span class="kc">null</span>
    <span class="p">].</span><span class="nx">concat</span> <span class="p">(</span><span class="s2">&quot;[#{card}, 1]&quot;</span> <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">trashPriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="k">when</span> <span class="nx">card</span><span class="o">?</span><span class="p">)</span><span class="o">\</span>
    <span class="p">.</span><span class="nx">concat</span> <span class="p">(</span><span class="s2">&quot;[#{card}, 0]&quot;</span> <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">)</span>
  
  <span class="nv">apprenticeTrashPriority: </span><span class="nf">(state, my) -&gt;</span>
    <span class="s2">&quot;Border Village&quot;</span>
    <span class="s2">&quot;Mandarin&quot;</span>
    <span class="s2">&quot;Ill-Gotten Gains&quot;</span> <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">coinLossMargin</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s2">&quot;Estate&quot;</span>
    <span class="s2">&quot;Curse&quot;</span>
    <span class="s2">&quot;Apprentice&quot;</span>
  
  <span class="nv">apprenticeTrashValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="nv">vp = </span><span class="nx">card</span><span class="p">.</span><span class="nx">getVP</span><span class="p">(</span><span class="nx">my</span><span class="p">)</span>
    <span class="p">[</span><span class="nx">coins</span><span class="p">,</span> <span class="nx">potions</span><span class="p">]</span> <span class="o">=</span> <span class="nx">card</span><span class="p">.</span><span class="nx">getCost</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">drawn = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">my</span><span class="p">.</span><span class="nx">draw</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">my</span><span class="p">.</span><span class="nx">discard</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">coins</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="nx">potions</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;trash&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nx">drawn</span> <span class="o">-</span> <span class="nx">vp</span>    </pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>The question here is: do you want to discard an Estate using a Baron?
And the answer is yes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">baronDiscardPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span><span class="kc">yes</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p><code>bishopTrashPriority</code> lists cards that are especially good to trash.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">bishopTrashPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Farmland&quot;</span>
    <span class="s2">&quot;Duchy&quot;</span> <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">goingGreen</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span>
    <span class="s2">&quot;Border Village&quot;</span>
    <span class="s2">&quot;Mandarin&quot;</span>
    <span class="s2">&quot;Bishop&quot;</span>
    <span class="s2">&quot;Ill-Gotten Gains&quot;</span> <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">coinLossMargin</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s2">&quot;Curse&quot;</span>
  <span class="p">]</span>

  <span class="nv">bishopTrashValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="p">[</span><span class="nx">coins</span><span class="p">,</span> <span class="nx">potions</span><span class="p">]</span> <span class="o">=</span> <span class="nx">card</span><span class="p">.</span><span class="nx">getCost</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">value = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">coins</span><span class="err">/2) - card.getVP(my)</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>if we're going for victory points, that's all we care about.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">goingGreen</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span>
      <span class="k">return</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>otherwise, focus on what we want to trash</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">card</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">trashPriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
        <span class="nx">value</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">and</span> <span class="p">((</span><span class="nx">card</span><span class="p">.</span><span class="nx">actions</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actionBalance</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
        <span class="nx">value</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span> <span class="o">and</span> <span class="nx">card</span><span class="p">.</span><span class="nx">coins</span> <span class="o">&gt;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">coinLossMargin</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nx">value</span> <span class="o">-=</span> <span class="mi">10</span>
      <span class="k">return</span> <span class="nx">value</span>

  <span class="nv">envoyValue: </span><span class="nf">(state, card, my) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Choose a card to discard from your opponent's hand when it's their turn.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">opp = </span><span class="nx">state</span><span class="p">.</span><span class="nx">current</span>
    <span class="k">if</span> <span class="nx">card</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;Tunnel&#39;</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">25</span>
    <span class="k">else</span> <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span><span class="p">)</span> <span class="o">and</span> <span class="o">not</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span><span class="p">)</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">10</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">opp</span><span class="p">.</span><span class="nx">actions</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">5</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">opp</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;=</span> <span class="mi">2</span>
      <span class="k">return</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cards</span> <span class="o">+</span> <span class="nx">card</span><span class="p">.</span><span class="nx">coins</span> <span class="o">+</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAttack</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="nx">card</span><span class="p">.</span><span class="nx">coins</span> <span class="o">+</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAttack</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p><code>foolsGoldTrashPriority</code> will trash a Fool's Gold for a real Gold if
it's nearing the endgame (5 gains or less), there is one FG in hand,
and losing it will not change its buy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">foolsGoldTrashPriority: </span><span class="nf">(state, my) -&gt;</span>
    <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">[</span><span class="s2">&quot;Fool&#39;s Gold&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">coinLossMargin</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
      <span class="p">[</span><span class="kc">yes</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="p">[</span><span class="kc">no</span><span class="p">]</span>  </pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Do you want to gain a copper from Ill-Gotten Gains? It's quite possible
in endgame situations, but for now the answer is no.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">gainCopperPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span><span class="kc">no</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>The <code>herbalist</code> decision puts a treasure card back on the deck. It sounds
the same as <code>putOnDeck</code>, but it's for a different
situation -- the card is coming from in play, not from your hand. So
actually we use the <code>mintValue</code> by default.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">herbalistValue: </span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mintValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>islandPriority chooses which card to set aside with Island. At present this
list is incomplete, but covers just about everything that we would want to set aside
with an Island.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">islandPriority: </span><span class="nf">(state, my) -&gt;</span>
    <span class="p">[</span>
      <span class="s2">&quot;Colony&quot;</span>
      <span class="s2">&quot;Province&quot;</span>
      <span class="s2">&quot;Fairgrounds&quot;</span>
      <span class="s2">&quot;Duchy&quot;</span>
      <span class="s2">&quot;Duke&quot;</span>
      <span class="s2">&quot;Gardens&quot;</span>
      <span class="s2">&quot;Vineyard&quot;</span>
      <span class="s2">&quot;Estate&quot;</span>
      <span class="s2">&quot;Copper&quot;</span>
      <span class="s2">&quot;Curse&quot;</span>
      <span class="s2">&quot;Island&quot;</span>
      <span class="s2">&quot;Tunnel&quot;</span>
    <span class="p">]</span>
  
  <span class="nv">islandValue: </span><span class="nf">(state, card, my) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">discardValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>

  <span class="nv">librarySetAsideValue: </span><span class="nf">(state, card, my) -&gt;</span> <span class="p">[</span>
    <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span>
      <span class="mi">1</span>
    <span class="k">else</span>
      <span class="o">-</span><span class="mi">1</span>
  <span class="p">]</span>

  <span class="nv">miningVillageTrashValue: </span><span class="nf">(state, choice, my) -&gt;</span>
    <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">goingGreen</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">and</span> <span class="k">this</span><span class="p">.</span><span class="nx">coinGainMargin</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span>
      <span class="mi">1</span>
    <span class="k">else</span>
      <span class="o">-</span><span class="mi">1</span>

  <span class="nv">minionDiscardValue: </span><span class="nf">(state, choice, my) -&gt;</span>
    <span class="k">if</span> <span class="nx">choice</span> <span class="o">==</span> <span class="kc">yes</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Find out how valuable it would be to discard these cards and draw 4.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">value = </span><span class="k">this</span><span class="p">.</span><span class="nx">discardHandValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">,</span> <span class="nx">my</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
      <span class="nv">opponent = </span><span class="nx">state</span><span class="p">.</span><span class="nx">players</span><span class="p">[</span><span class="nx">state</span><span class="p">.</span><span class="nx">players</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>If the attack would decrease an opponent's hand size, it's more valuable.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">opponent</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">4</span>
        <span class="nx">value</span> <span class="o">+=</span> <span class="mi">2</span>
      <span class="k">return</span> <span class="nx">value</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Mint anything but Copper and Diadem. Otherwise, go mostly by the card's base cost.
There is only 1 Diadem, never any available to gain, so never Mint it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mintValue: </span><span class="nf">(state, card, my) -&gt;</span> 
    <span class="k">return</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span> <span class="o">-</span> <span class="mi">1</span>
  </pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Choose whether we want these cards or two random cards.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">oracleDiscardValue: </span><span class="nf">(state, cards, my) -&gt;</span>
    <span class="nv">deck = </span><span class="nx">my</span><span class="p">.</span><span class="nx">discard</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">my</span><span class="p">.</span><span class="nx">draw</span><span class="p">)</span>
    <span class="nx">shuffle</span><span class="p">(</span><span class="nx">deck</span><span class="p">)</span>
    <span class="nv">randomCards = </span><span class="nx">deck</span><span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">cards</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>

    <span class="k">return</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">compareByDiscarding</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">randomCards</span><span class="p">),</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">cards</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Choose to attack or use available coins when playing Pirate Ship.
Current strategy is basically Geronimoo's attackUntil5Coins play strategy,
but only with Provinces--or technically, cards costing 8 or more.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pirateShipPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;coins&#39;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">mats</span><span class="p">.</span><span class="nx">pirateShip</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="o">and</span> <span class="nx">state</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">getAvailableMoney</span><span class="p">()</span><span class="o">+</span><span class="nx">state</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">mats</span><span class="p">.</span><span class="nx">pirateShip</span> <span class="o">&gt;=</span> <span class="mi">8</span>
    <span class="s1">&#39;attack&#39;</span>
  <span class="p">]</span>

  <span class="nv">salvagerTrashPriority: </span><span class="nf">(state, card, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Border Village&quot;</span>
    <span class="s2">&quot;Mandarin&quot;</span>
    <span class="s2">&quot;Ill-Gotten Gains&quot;</span> <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">coinLossMargin</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s2">&quot;Salvager&quot;</span>
  <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>To calculate the salvagerTrashValue, we simulate trashing each card, determine
the best card we would buy as a result, and evaluate it as if we were
upgrading the trashed card into the bought one.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">salvagerTrashValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="p">[</span><span class="nx">hypothesis</span><span class="p">,</span> <span class="nx">hypothetically_my</span><span class="p">]</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">hypothetical</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="nx">hypothetically_my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">card</span><span class="p">)</span>
    <span class="p">[</span><span class="nx">coins</span><span class="p">,</span> <span class="nx">potions</span><span class="p">]</span> <span class="o">=</span> <span class="nx">card</span><span class="p">.</span><span class="nx">getCost</span><span class="p">(</span><span class="nx">hypothesis</span><span class="p">)</span>
    <span class="nx">hypothetically_my</span><span class="p">.</span><span class="nx">coins</span> <span class="o">+=</span> <span class="nx">coins</span>
    <span class="nx">hypothetically_my</span><span class="p">.</span><span class="nx">buys</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nv">buyState = </span><span class="k">this</span><span class="p">.</span><span class="nx">fastForwardToBuy</span><span class="p">(</span><span class="nx">hypothesis</span><span class="p">,</span> <span class="nx">hypothetically_my</span><span class="p">)</span>
    <span class="nv">gained = </span><span class="nx">buyState</span><span class="p">.</span><span class="nx">getSingleBuyDecision</span><span class="p">()</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">upgradeValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="p">[</span><span class="nx">card</span><span class="p">,</span> <span class="nx">gained</span><span class="p">],</span> <span class="nx">my</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Scheme uses the same priority function as multiplied actions.  Good actions
to multiply this turn are typically good actions to have around next turn.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">schemeValue: </span><span class="nf">(state, card, my) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Project a little of what the state will look like at the beginning of the
next turn.  This keeps multipliedActionPriority from evaluating a card
as though it will be used in the current (finished) turn.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">myNext = </span><span class="p">{}</span>
    <span class="nx">myNext</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span> <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">my</span>
    <span class="nv">myNext.actions = </span><span class="mi">1</span>
    <span class="nv">myNext.buys = </span><span class="mi">1</span>
    <span class="nv">myNext.coins = </span><span class="mi">0</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getChoiceValue</span><span class="p">(</span><span class="s1">&#39;multiplied&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">myNext</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p><code>scryingPoolDiscardValue</code> is like <code>discardValue</code>, except it strongly
prefers to discard non-actions.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">scryingPoolDiscardValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span>
      <span class="mi">2000</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">)</span>

  <span class="nv">spiceMerchantTrashPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Copper&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Potion&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Loan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Ill-Gotten Gains&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fool&#39;s Gold&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Fool&#39;s Gold&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;Silver&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="kc">null</span><span class="p">,</span>
    <span class="s2">&quot;Silver&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Venture&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Cache&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Gold&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Harem&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Platinum&quot;</span>
  <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Which treasure, if any, should be discarded to feed Stables? Defaults
to a list of generally crappy treasures. Doesn't include $1 Fool's Gold
because you presumably have another one you're trying to draw.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">stablesDiscardPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Copper&quot;</span>
    <span class="s2">&quot;Potion&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInPlay</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">[</span><span class="s2">&quot;Alchemist&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="s2">&quot;Ill-Gotten Gains&quot;</span>
    <span class="s2">&quot;Silver&quot;</span>
    <span class="s2">&quot;Horn of Plenty&quot;</span>
    <span class="kc">null</span>
    <span class="s2">&quot;Potion&quot;</span>
    <span class="s2">&quot;Venture&quot;</span>
    <span class="s2">&quot;Cache&quot;</span>
    <span class="s2">&quot;Gold&quot;</span>
    <span class="s2">&quot;Platinum&quot;</span>
  <span class="p">]</span>
   </pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Do you want to discard a Province to win a Tournament? The answer is
<em>very</em> yes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tournamentDiscardPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span><span class="kc">yes</span><span class="p">]</span>

  <span class="nv">transmuteValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="k">if</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">and</span> <span class="k">this</span><span class="p">.</span><span class="nx">goingGreen</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">10</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">and</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isVictory</span> <span class="o">and</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span> <span class="o">&lt;=</span> <span class="mi">4</span>
      <span class="k">return</span> <span class="mi">1000</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;trash&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p><code>wishValue</code> prefers to wish for the card its draw pile contains
the most of.</p>

<p>The fact that this doesn't make a hypothetical copy is a shortcut. We are
technically "peeking" at the deck, but we don't use any information except
the count of each card, which would be the same in any hypothetical version.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">wishValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="nv">pile = </span><span class="nx">my</span><span class="p">.</span><span class="nx">draw</span>
    <span class="k">if</span> <span class="nx">pile</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="nv">pile = </span><span class="nx">my</span><span class="p">.</span><span class="nx">discard</span>
    <span class="k">return</span> <span class="nx">countInList</span><span class="p">(</span><span class="nx">pile</span><span class="p">,</span> <span class="nx">card</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Choose to discard or to gain a curse when attacked by Torturer.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">torturerPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;curse&#39;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">countInSupply</span><span class="p">(</span><span class="s2">&quot;Curse&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="s1">&#39;discard&#39;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToDiscard</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="s1">&#39;discard&#39;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="s1">&#39;curse&#39;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">trashingInHand</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s1">&#39;curse&#39;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">3</span>
    <span class="s1">&#39;discard&#39;</span>
    <span class="s1">&#39;curse&#39;</span>
  <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <h3>Trash-for-benefit decisions</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Taking into account gain priorities, gain values, trash priorities, and
trash values, how much do we like having this card in our deck overall?</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">cardInDeckValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="nv">endgamePower = </span><span class="mi">1</span>
    </pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Are we in the late game? If so, we care much more about getting cards
at the top of our priority order.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">5</span>
      <span class="nv">endgamePower = </span><span class="mi">3</span>

    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;trash&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">))</span> <span class="o">+</span> <span class="o">\</span>
           <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;gain&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">),</span> <span class="nx">endgamePower</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>upgradeValue measures the benefit of choices on Remodel, Upgrade,
and so on, where you exchange one card for a better one.</p>

<p>So here's a really basic thing that might work.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">upgradeValue: </span><span class="nf">(state, choice, my) -&gt;</span>
    <span class="p">[</span><span class="nx">oldCard</span><span class="p">,</span> <span class="nx">newCard</span><span class="p">]</span> <span class="o">=</span> <span class="nx">choice</span>
    <span class="k">return</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">cardInDeckValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">newCard</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="o">-</span> <span class="o">\</span>
           <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">cardInDeckValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">oldCard</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p><code>chooseOrderOnDeck</code> handles situations where multiple cards are returned
to the deck, such as Scout and Apothecary.</p>

<p>This decision doesn't fit into the xPriority / xValue framework, as there
are a number of mostly indistinguishable choices. Instead of listing all
the permutations of cards as choices, we just list the cards to arrange.</p>

<p>The default decision is to put the cards with the lowest discard value on
top.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseOrderOnDeck: </span><span class="nf">(state, cards, my) -&gt;</span>
    <span class="nv">sorter = </span><span class="nf">(card1, card2) -&gt;</span>
      <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card1</span><span class="p">)</span><span class="o">\</span>
      <span class="o">-</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card2</span><span class="p">)</span>
    
    <span class="nv">choice = </span><span class="nx">cards</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">choice</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">sorter</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <h3>Informational methods</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>When presented with a card with simple but variable benefits, such as
Nobles, this is the default way for an AI to decide which benefit it wants.
This function should actually handle a number of common situations.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">benefitValue: </span><span class="nf">(state, choice, my) -&gt;</span>
    <span class="nv">buyValue = </span><span class="mi">1</span>
    <span class="nv">cardValue = </span><span class="mi">2</span>
    <span class="nv">coinValue = </span><span class="mi">3</span>
    <span class="nv">trashValue = </span><span class="mi">4</span>      <span class="c1"># if there are cards we want to trash</span>
    <span class="nv">actionValue = </span><span class="mi">10</span>    <span class="c1"># if we need more actions</span>

    <span class="nv">actionBalance = </span><span class="nx">my</span><span class="p">.</span><span class="nx">actionBalance</span><span class="p">()</span>
    <span class="nv">usableActions = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">actionBalance</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">actionBalance</span> <span class="o">&gt;=</span> <span class="mi">1</span>
      <span class="nx">cardValue</span> <span class="o">+=</span> <span class="nx">actionBalance</span>
    <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">trash</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">trashValue = </span><span class="o">-</span><span class="mi">4</span>
    
    <span class="nv">value = </span><span class="nx">cardValue</span> <span class="o">*</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">cards</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">value</span> <span class="o">+=</span> <span class="nx">coinValue</span> <span class="o">*</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">coins</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">value</span> <span class="o">+=</span> <span class="nx">buyValue</span> <span class="o">*</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">buys</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">value</span> <span class="o">+=</span> <span class="nx">trashValue</span> <span class="o">*</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">trash</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">value</span> <span class="o">+=</span> <span class="nx">actionValue</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">((</span><span class="nx">choice</span><span class="p">.</span><span class="nx">actions</span> <span class="o">?</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">usableActions</span><span class="p">)</span>
    <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p><code>wantsToTrash</code> returns the number of cards in hand that we would trash
for no benefit.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">wantsToTrash: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">trashableCards = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span>
      <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">chooseTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="p">[</span><span class="nx">card</span><span class="p">,</span> <span class="kc">null</span><span class="p">])</span> <span class="o">is</span> <span class="nx">card</span>
        <span class="nx">trashableCards</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">trashableCards</span>
  </pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p><code>wantsToDiscard</code> returns the number of cards in hand that we would
freely discard.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">wantsToDiscard: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">discardableCards = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span>
      <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">chooseDiscard</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="p">[</span><span class="nx">card</span><span class="p">,</span> <span class="kc">null</span><span class="p">])</span> <span class="o">is</span> <span class="nx">card</span>
        <span class="nx">discardableCards</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">discardableCards</span>
  
  <span class="nv">multiplierChoices: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">mults = </span><span class="p">(</span><span class="nx">card</span> <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span> <span class="k">when</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isMultiplier</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">mults</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nv">mult = </span><span class="nx">mults</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">choices = </span><span class="p">(</span><span class="nx">card</span> <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span> <span class="k">when</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span><span class="p">)</span>
      <span class="nx">choices</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">mult</span><span class="p">)</span>
      <span class="nx">choices</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">choices</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="p">[]</span>

  <span class="nv">okayToPlayMultiplier: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">choices = </span><span class="k">this</span><span class="p">.</span><span class="nx">multiplierChoices</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;multiplied&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span><span class="o">?</span>
      <span class="k">return</span> <span class="kc">true</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="kc">false</span>

  <span class="nv">wantsToPlayMultiplier: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">choices = </span><span class="k">this</span><span class="p">.</span><span class="nx">multiplierChoices</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="nv">choice = </span><span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;multiplied&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span>
      <span class="nv">multipliedValue = </span><span class="k">this</span><span class="p">.</span><span class="nx">getChoiceValue</span><span class="p">(</span><span class="s1">&#39;multiplied&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">choice</span><span class="o">?</span> <span class="o">and</span> <span class="nx">choice</span><span class="p">.</span><span class="nx">isMultiplier</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>prevent infinite loops</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">unmultipliedValue = </span><span class="mi">0</span>
      <span class="k">else</span>
        <span class="nv">unmultipliedValue = </span><span class="k">this</span><span class="p">.</span><span class="nx">getChoiceValue</span><span class="p">(</span><span class="s1">&#39;play&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">multipliedValue</span> <span class="o">&gt;</span> <span class="nx">unmultipliedValue</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p><code>goingGreen</code>: determine when we're playing for victory points. By default,
it's if there are any Colonies, Provinces, or Duchies in the deck.</p>

<p>The bigger the number, the greener the deck, but a true (greater than 0)
value is a good indication in itself that we want victory cards.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">goingGreen: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">bigGreen = </span><span class="nx">my</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Colony&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Province&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Duchy&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">bigGreen</span>
  </pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p><code>pessimisticMoneyInHand</code> establishes a minimum on how much money the
player will be able to spend in this game state. It assumes the player
will draw no money from the deck.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pessimisticMoneyInHand: </span><span class="nf">(state) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Don't recurse more than once. If we're already in a hypothetical
situation, use the stupid version instead.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">depth</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">).</span><span class="nx">getAvailableMoney</span><span class="p">()</span>

    <span class="nv">buyPhase = </span><span class="k">this</span><span class="p">.</span><span class="nx">pessimisticBuyPhase</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">buyPhase</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">coins</span>
  </pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Look ahead to the buy phase, assuming we draw no money from the deck.</p>

<p>TODO: when we can handle known cards on top of the deck, take them
into account.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pessimisticBuyPhase: </span><span class="nf">(state) -&gt;</span>
    <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">depth</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>A last-ditch effort to avoid recursion, by simply fast-forwarding
to the next phase.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">phase</span> <span class="o">==</span> <span class="s1">&#39;action&#39;</span>
        <span class="nv">state.phase = </span><span class="s1">&#39;treasure&#39;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">phase</span> <span class="o">==</span> <span class="s1">&#39;treasure&#39;</span>
        <span class="nv">state.phase = </span><span class="s1">&#39;buy&#39;</span>
    
    <span class="p">[</span><span class="nx">hypothesis</span><span class="p">,</span> <span class="nx">hypothetically_my</span><span class="p">]</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">hypothetical</span><span class="p">(</span><span class="k">this</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>We need to save draw and discard before emptying and restore them before buyPhase, to be able to choose the right buys in actionPriority(state)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fastForwardToBuy</span><span class="p">(</span><span class="nx">hypothesis</span><span class="p">,</span> <span class="nx">hypothetically_my</span><span class="p">)</span>

  <span class="nv">fastForwardToBuy: </span><span class="nf">(state, my) -&gt;</span>
    <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">depth</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Can only fast-forward in a hypothetical state&quot;</span><span class="p">)</span>
    <span class="nv">oldDraws   = </span><span class="nx">my</span><span class="p">.</span><span class="nx">draw</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="nv">oldDiscard = </span><span class="nx">my</span><span class="p">.</span><span class="nx">discard</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="nv">my.draw = </span><span class="p">[]</span>
    <span class="nv">my.discard = </span><span class="p">[]</span>
    
    <span class="k">while</span> <span class="nx">state</span><span class="p">.</span><span class="nx">phase</span> <span class="o">!=</span> <span class="s1">&#39;buy&#39;</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">doPlay</span><span class="p">()</span>
      
    <span class="nv">my.draw = </span><span class="nx">oldDraws</span>
    <span class="nv">my.discard = </span><span class="nx">oldDiscard</span>

    <span class="k">return</span> <span class="nx">state</span>
  
  <span class="nv">pessimisticCardsGained: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">newState = </span><span class="k">this</span><span class="p">.</span><span class="nx">pessimisticBuyPhase</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nx">newState</span><span class="p">.</span><span class="nx">doPlay</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">newState</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">gainedThisTurn</span>
  </pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>coinLossMargin determines how much treasure the player can lose
"for free" (because it won't change their buy decision). Intended to be
more efficient than calling pessimisticCardsGained on a number
of different states.</p>

<p>TODO: do we need an equivalent for potions?</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">coinLossMargin: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">newState = </span><span class="k">this</span><span class="p">.</span><span class="nx">pessimisticBuyPhase</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">coins = </span><span class="nx">newState</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">coins</span>
    <span class="nv">cardToBuy = </span><span class="nx">newState</span><span class="p">.</span><span class="nx">getSingleBuyDecision</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="nx">cardToBuy</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="p">[</span><span class="nx">coinsCost</span><span class="p">,</span> <span class="nx">potionsCost</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cardToBuy</span><span class="p">.</span><span class="nx">getCost</span><span class="p">(</span><span class="nx">newState</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">coins</span> <span class="o">-</span> <span class="nx">coinsCost</span>
  </pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>coinGainMargin determines how much treasure the player wants to gain,
in order to get a better card. Tries up to +$8, then returns Infinity
if nothing changes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">coinGainMargin: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">newState = </span><span class="k">this</span><span class="p">.</span><span class="nx">pessimisticBuyPhase</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">coins = </span><span class="nx">newState</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">coins</span>
    <span class="nv">baseCard = </span><span class="nx">newState</span><span class="p">.</span><span class="nx">getSingleBuyDecision</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">increment</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
      <span class="nv">newState.current.coins = </span><span class="nx">coins</span><span class="o">+</span><span class="nx">increment</span>
      <span class="nv">cardToBuy = </span><span class="nx">newState</span><span class="p">.</span><span class="nx">getSingleBuyDecision</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">cardToBuy</span> <span class="o">!=</span> <span class="nx">baseCard</span>
        <span class="k">return</span> <span class="nx">increment</span>
    <span class="k">return</span> <span class="kc">Infinity</span>
  </pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Estimate the number of coins we'd lose by discarding/trashing/putting back
a card.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">coinsDueToCard: </span><span class="nf">(state, card) -&gt;</span>
    <span class="nv">c = </span><span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span>
    <span class="nv">value = </span><span class="nx">card</span><span class="p">.</span><span class="nx">getCoins</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span>
      <span class="nv">banks = </span><span class="nx">state</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">.</span><span class="nx">Bank</span><span class="p">)</span>
      <span class="nx">value</span> <span class="o">+=</span> <span class="nx">banks</span>
      <span class="k">if</span> <span class="nx">card</span> <span class="o">is</span> <span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">.</span><span class="nx">Bank</span>
        <span class="nv">nonbanks = </span><span class="p">(</span><span class="nx">aCard</span> <span class="k">for</span> <span class="nx">aCard</span> <span class="k">in</span> <span class="nx">state</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">hand</span> <span class="k">when</span> <span class="nx">aCard</span><span class="p">.</span><span class="nx">isTreasure</span><span class="p">).</span><span class="nx">length</span>
        <span class="nx">value</span> <span class="o">+=</span> <span class="nx">nonbanks</span>
    <span class="nx">value</span>
  </pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>Figure out whether hand1 or hand2 is better by discarding their cards
in priority order, until one of them gets to 2 or fewer cards.</p>

<p>Returns a -1 or 1 that can be used in sorting; it's
positive if the first hand is better.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">compareByDiscarding: </span><span class="nf">(state, hand1, hand2) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>Guard against accidental mutation; we're going to be messing with
these lists.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">hand1 = </span><span class="nx">hand1</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="nv">hand2 = </span><span class="nx">hand2</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>Preserve our number of actions.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">savedActions = </span><span class="nx">state</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">actions</span>
    <span class="nv">state.current.actions = </span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>state.log("hand1 = #{hand1}")
state.log("hand2 = #{hand2}")</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">counter = </span><span class="mi">0</span>
    <span class="nx">loop</span>
      <span class="nx">counter</span><span class="o">++</span>
      <span class="k">if</span> <span class="nx">counter</span> <span class="o">&gt;=</span> <span class="mi">100</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;got stuck in a loop&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Figure out whether we'd rather discard from hand1 or hand2.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">discard1 = </span><span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">hand1</span><span class="p">)</span>
      <span class="nv">value1 = </span><span class="k">this</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">discard1</span><span class="p">)</span>
      <span class="nv">discard2 = </span><span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">hand2</span><span class="p">)</span>
      <span class="nv">value2 = </span><span class="k">this</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">discard2</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">value1</span> <span class="o">&gt;</span> <span class="nx">value2</span>
        <span class="nx">hand1</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">discard1</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">value2</span> <span class="o">&gt;</span> <span class="nx">value1</span>
        <span class="nx">hand2</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">discard2</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nx">hand1</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">discard1</span><span class="p">)</span>
        <span class="nx">hand2</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">discard2</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">hand1</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="o">and</span> <span class="nx">hand2</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">2</span>
        <span class="nv">state.current.actions = </span><span class="nx">savedActions</span>
        <span class="k">return</span> <span class="mi">0</span>      
      <span class="k">if</span> <span class="nx">hand1</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">2</span>
        <span class="nv">state.current.actions = </span><span class="nx">savedActions</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">if</span> <span class="nx">hand2</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">2</span>
        <span class="nv">state.current.actions = </span><span class="nx">savedActions</span>
        <span class="k">return</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <h3>Utility methods</h3>

<p><code>copy</code> makes a copy of the AI. It will have the same behavior but a
different name, and will not be equal to this AI.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copy: </span><span class="p">()</span> <span class="o">=&gt;</span>
    <span class="nv">ai = </span><span class="k">new</span> <span class="nx">BasicAI</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="k">this</span>
      <span class="nx">ai</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="nv">ai.name = </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39;*&#39;</span>
    <span class="nx">ai</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Some functions need to check the actionPriority a lot. This pair of
methods will save a cached value so you don't need to run such an expensive
function over and over.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">cachedActionPriority: </span><span class="nf">(state, my) -&gt;</span>
    <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">cachedAP</span>
    
  <span class="nv">cacheActionPriority: </span><span class="nf">(state, my) -&gt;</span>
    <span class="vi">@cachedAP = </span><span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">actionPriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>

  <span class="nv">toString: </span><span class="nf">() -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span>
<span class="k">this</span><span class="p">.</span><span class="nv">BasicAI = </span><span class="nx">BasicAI</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <h2>Utility functions</h2>

<p><code>count</code> counts the number of times <code>elt</code> appears in <code>list</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">countInList = </span><span class="nf">(list, elt) -&gt;</span>
  <span class="nv">count = </span><span class="mi">0</span>
  <span class="k">for</span> <span class="nx">member</span> <span class="k">in</span> <span class="nx">list</span>
    <span class="k">if</span> <span class="nx">member</span> <span class="o">==</span> <span class="nx">elt</span>
      <span class="nx">count</span><span class="o">++</span>
  <span class="nx">count</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p><code>stringify</code> turns an object into a string, while handling <code>null</code> safely.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">stringify = </span><span class="nf">(obj) -&gt;</span>
  <span class="k">if</span> <span class="nx">obj</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="k">return</span> <span class="kc">null</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>General function to randomly shuffle a list.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">shuffle = </span><span class="nf">(v) -&gt;</span>
  <span class="nv">i = </span><span class="nx">v</span><span class="p">.</span><span class="nx">length</span>
  <span class="k">while</span> <span class="nx">i</span>
    <span class="nv">j = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">i</span><span class="p">)</span>
    <span class="nx">i</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="nv">temp = </span><span class="nx">v</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="nx">v</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
    <span class="nx">v</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">temp</span>
  <span class="nx">v</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 