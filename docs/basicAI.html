<!DOCTYPE html>  <html> <head>   <title>basicAI.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="basicAI.html">                 basicAI.coffee               </a>                                           <a class="source" href="cards.html">                 cards.coffee               </a>                                           <a class="source" href="compileStrategies.html">                 compileStrategies.coffee               </a>                                           <a class="source" href="gameState.html">                 gameState.coffee               </a>                                           <a class="source" href="heuristics.html">                 heuristics.coffee               </a>                                           <a class="source" href="play.html">                 play.coffee               </a>                                           <a class="source" href="playWeb.html">                 playWeb.coffee               </a>                                           <a class="source" href="testSimulation.html">                 testSimulation.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               basicAI.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>The Basic AI</h2>

<p>This class defines a rule-based AI of the kind that is popular
for evaluating Dominion strategies. It can be subclassed -- or simply
have its methods overwritten on an instance -- to play new strategies.</p>

<p>Every time the player needs to make a meaningful decision, a method called
<code>chooseX</code> (for some X) will be called on the AI, which can examine the game
state and make a decision accordingly.</p>

<p>In any case that is not a simple yes/no decision, the method will be 
given a list of choices. It will delegate to the <code>xValue</code> method to assign a
value to each possible choice, and choose the one with the highest value
(earlier options win ties).</p>

<p>If the <code>xValue</code> method does not exist (as will often be the case), it will
try a different method called <code>xPriority</code>, which takes in the state and
returns an ordered list of choices. The player will make the first valid
choice in that list. Priority functions are usually easier to define than
value functions.</p>

<p>The BasicAI has a default decision function for every decision, so
every AI that derives from it will have <em>some</em> way to decide what to do in
any situation. However, when defining an AI, you will often want to override
some of these decision functions.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">BasicAI</span>
  <span class="nv">name: </span><span class="s1">&#39;Basic AI&#39;</span>
  <span class="nv">author: </span><span class="s1">&#39;rspeer&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Referring to <code>state.current</code> to find information about one's own state is
not always safe! Some of these decisions may be made during other players'
turns. In those cases, what we want is <code>this.myPlayer(state)</code>.</p>

<p>This is passed in as an argument <code>my</code> to the decision functions, because
it's convenient and it creates nice idioms such as <code>my.hand</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">myPlayer: </span><span class="nf">(state) -&gt;</span>
    <span class="k">for</span> <span class="nx">player</span> <span class="k">in</span> <span class="nx">state</span><span class="p">.</span><span class="nx">players</span>
      <span class="k">if</span> <span class="nx">player</span><span class="p">.</span><span class="nx">ai</span> <span class="o">is</span> <span class="k">this</span>
        <span class="k">return</span> <span class="nx">player</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;#{this} is being asked to make a decision, but isn&#39;t playing the game...?&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Decision-making machinery</h2>

<p>Make the AI's preferred choice, first by checking its explicit priority
list. If no valid choices are on the list, ask the value function instead.</p>

<p>The priority function returns an ordered list of choices it will want to
make when they are available. If 'null' is on the priority list, that
represents an explicit preference to choose "none of the above" when it's
an option.</p>

<p>The value list assigns a numerical value to every possible choice. 'null'
automatically has a value of 0. Here you can represent actions you will
only take when forced to, by giving them negative values.</p>

<p>If a choice should be made entirely using the value function, make the
priority function return an empty list.</p>

<p>This function replaces two older functions called <code>choosePriority</code> and
<code>chooseValue</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseByPriorityAndValue: </span><span class="nf">(state, choices, priorityfunc, valuefunc) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Are there no choices? We follow the rule that makes the null choice
available in that situation, and choose it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>First, try the priority function. If the priority function reaches
the end of its list, it is treated as "none of the above".</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">priorityfunc</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Construct an object with the choices as keys, so we can look them
up quickly.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">choiceSet = </span><span class="p">{}</span>
      <span class="k">for</span> <span class="nx">choice</span> <span class="k">in</span> <span class="nx">choices</span>
        <span class="nx">choiceSet</span><span class="p">[</span><span class="nx">choice</span><span class="p">]</span> <span class="o">=</span> <span class="nx">choice</span>
      </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Get the priority list.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">priority = </span><span class="nx">priorityfunc</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Now look up all the preferences in that list. The moment we encounter
a valid choice, we can return it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="nx">preference</span> <span class="k">in</span> <span class="nx">priority</span>
        <span class="k">if</span> <span class="nx">preference</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">and</span> <span class="kc">null</span> <span class="k">in</span> <span class="nx">choices</span>
          <span class="k">return</span> <span class="kc">null</span>
        <span class="k">if</span> <span class="nx">choiceSet</span><span class="p">[</span><span class="nx">preference</span><span class="p">]</span><span class="o">?</span>
          <span class="k">return</span> <span class="nx">choiceSet</span><span class="p">[</span><span class="nx">preference</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>The priority list doesn't want any of these choices (perhaps because
it doesn't exist). Now try the value list.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">valuefunc</span><span class="o">?</span>
      <span class="nv">bestChoice = </span><span class="kc">null</span>
      <span class="nv">bestValue = </span><span class="o">-</span><span class="kc">Infinity</span>
    
      <span class="k">for</span> <span class="nx">choice</span> <span class="k">in</span> <span class="nx">choices</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">choice</span> <span class="o">is</span> <span class="kc">null</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">choice</span> <span class="o">is</span> <span class="kc">no</span><span class="p">)</span>
          <span class="nv">value = </span><span class="mi">0</span>
        <span class="k">else</span>
          <span class="nv">value = </span><span class="nx">valuefunc</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">bestValue</span>
          <span class="nv">bestValue = </span><span class="nx">value</span>
          <span class="nv">bestChoice = </span><span class="nx">choice</span>
      </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>If we got a valid choice, return it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">bestChoice</span> <span class="k">in</span> <span class="nx">choices</span>
        <span class="k">return</span> <span class="nx">bestChoice</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>If we get here, the AI probably wants to choose none of the above.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="kc">null</span> <span class="k">in</span> <span class="nx">choices</span>
      <span class="k">return</span> <span class="kc">null</span>
    </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Hmm. None of the above isn't an option, and neither the priority list nor
the value list gave us anything. First complain about it, then make an
arbitrary choice.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">state</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;#{this} has no idea what to choose from #{choices}&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Sometimes we need to compare choices in a strictly numeric way. This takes
a particular choice for a particular choice type, and gets its numeric value.
If the value comes from a priority list, it will be 1000 - (index in list).</p>

<p>So, for example, the default choiceToValue of discarding a Colony is 999, while
the choiceToValue of discarding an extra terminal is 1.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">choiceToValue: </span><span class="nf">(type, state, choice) -&gt;</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="nx">choice</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">priorityfunc = </span><span class="k">this</span><span class="p">[</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;Priority&#39;</span><span class="p">]</span>
    <span class="nv">valuefunc = </span><span class="k">this</span><span class="p">[</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">priorityfunc</span><span class="o">?</span>
      <span class="nv">priority = </span><span class="nx">priorityfunc</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">priority = </span><span class="p">[]</span>

    <span class="nv">index = </span><span class="nx">priority</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">choice</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">priority</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">index</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">valuefunc</span><span class="o">?</span>
      <span class="k">return</span> <span class="nx">valuefunc</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="mi">0</span>
 </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>The top-level "choose" function takes a decision type, the current state,
and a list of choices. It delegates to other functions with the appropriate
names automatically: for example, if the type is 'foo', the AI will check
its fooValue and fooPriority functions.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">choose: </span><span class="nf">(type, state, choices) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Get the priority and value functions. If one doesn't exist, that's okay,
we'll pass on the 'undefined' value and chooseByPriorityAndValue will
know what to do.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">priorityfunc = </span><span class="k">this</span><span class="p">[</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;Priority&#39;</span><span class="p">]</span>
    <span class="nv">valuefunc = </span><span class="k">this</span><span class="p">[</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">chooseByPriorityAndValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="nx">priorityfunc</span><span class="p">,</span> <span class="nx">valuefunc</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h3>Backwards-compatible choices</h3>

<p>To avoid having to rewrite all the code at once, we support these functions
that pass <code>chooseAction</code> onto <code>choose('action')</code>, and so on.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseAction: </span><span class="nf">(state, choices) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span>
  <span class="nv">chooseTreasure: </span><span class="nf">(state, choices) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;treasure&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span>
  <span class="nv">chooseGain: </span><span class="nf">(state, choices) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;gain&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span>
  <span class="nv">chooseDiscard: </span><span class="nf">(state, choices) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span>
  <span class="nv">chooseTrash: </span><span class="nf">(state, choices) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;trash&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h2>Default strategies</h2>

<p>The default buying strategy is a form of Big Money that has, by now,
been beaten by the newer one in BigMoney.coffee.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">gainPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Colony&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Platinum&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s2">&quot;Province&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">countInSupply</span><span class="p">(</span><span class="s2">&quot;Colony&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">6</span>
    <span class="s2">&quot;Duchy&quot;</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">5</span>
    <span class="s2">&quot;Estate&quot;</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Platinum&quot;</span>
    <span class="s2">&quot;Gold&quot;</span>
    <span class="s2">&quot;Silver&quot;</span>
    <span class="s2">&quot;Copper&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">3</span>
  <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>The default action-playing strategy, which aims to include a usable plan
for playing every action card, so that most AIs don't need to override it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">actionPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>First priority: cards that succeed if we play them now, and might
not if we play them later.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Menagerie&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">menagerieDraws</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="s2">&quot;Shanty Town&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">shantyTownDraws</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="s2">&quot;Tournament&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Province&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Second priority: cards that stack the deck.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Lookout&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="o">or</span> <span class="nx">state</span><span class="p">.</span><span class="nx">cardInfo</span><span class="p">.</span><span class="nx">Curse</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">draw</span>
    <span class="s2">&quot;Bag of Gold&quot;</span>
    <span class="s2">&quot;Apothecary&quot;</span>
    <span class="s2">&quot;Scout&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Third priority: cards that give +2 actions.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Trusty Steed&quot;</span>
    <span class="s2">&quot;Festival&quot;</span>
    <span class="s2">&quot;University&quot;</span>
    <span class="s2">&quot;Farming Village&quot;</span>
    <span class="s2">&quot;Bazaar&quot;</span>
    <span class="s2">&quot;Worker&#39;s Village&quot;</span>
    <span class="s2">&quot;City&quot;</span>
    <span class="s2">&quot;Walled Village&quot;</span>
    <span class="s2">&quot;Fishing Village&quot;</span>
    <span class="s2">&quot;Village&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Fourth priority: cards that give +1 action and are almost always good.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Grand Market&quot;</span>
    <span class="s2">&quot;Hunting Party&quot;</span>
    <span class="s2">&quot;Alchemist&quot;</span>
    <span class="s2">&quot;Laboratory&quot;</span>
    <span class="s2">&quot;Caravan&quot;</span>
    <span class="s2">&quot;Market&quot;</span>
    <span class="s2">&quot;Peddler&quot;</span>
    <span class="s2">&quot;Treasury&quot;</span>
    <span class="s2">&quot;Conspirator&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">inPlay</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Familiar&quot;</span>
    <span class="s2">&quot;Great Hall&quot;</span>
    <span class="s2">&quot;Wishing Well&quot;</span>
    <span class="s2">&quot;Lighthouse&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Fifth priority: terminal card-drawers, if we have actions to spare.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">4</span>
    <span class="s2">&quot;Rabble&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Smithy&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">4</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">5</span>
    <span class="s2">&quot;Courtyard&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">lenth</span> <span class="o">&lt;=</span> <span class="mi">3</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Sixth priority: card-cycling that might improve the hand.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Upgrade&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="s2">&quot;Pawn&quot;</span>
    <span class="s2">&quot;Warehouse&quot;</span>
    <span class="s2">&quot;Cellar&quot;</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">6</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Seventh priority: non-terminal cards that don't succeed but at least
give us something.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Tournament&quot;</span>
    <span class="s2">&quot;Menagerie&quot;</span>
    <span class="s2">&quot;Shanty Town&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&lt;</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Seventh priority: terminals. Of course, Nobles might be a non-terminal
if we decide we need the actions more than the cards.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Nobles&quot;</span>
    <span class="s2">&quot;Treasure Map&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Treasure Map&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Followers&quot;</span>
    <span class="s2">&quot;Mountebank&quot;</span>
    <span class="s2">&quot;Witch&quot;</span>
    <span class="s2">&quot;Torturer&quot;</span>
    <span class="s2">&quot;Sea Hag&quot;</span>
    <span class="s2">&quot;Tribute&quot;</span> <span class="c1"># after Cursers but before other terminals, there is probably a better spot for it</span>
    <span class="s2">&quot;Goons&quot;</span>
    <span class="s2">&quot;Wharf&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Tactician needs a play condition, but I don't know what it would be.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Tactician&quot;</span>
    <span class="s2">&quot;Masquerade&quot;</span>
    <span class="s2">&quot;Vault&quot;</span>
    <span class="s2">&quot;Princess&quot;</span>
    <span class="s2">&quot;Explorer&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Province&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">3</span>
    <span class="s2">&quot;Expand&quot;</span>
    <span class="s2">&quot;Remodel&quot;</span>
    <span class="s2">&quot;Militia&quot;</span>
    <span class="s2">&quot;Cutpurse&quot;</span>
    <span class="s2">&quot;Bridge&quot;</span>
    <span class="s2">&quot;Horse Traders&quot;</span>
    <span class="s2">&quot;Steward&quot;</span>
    <span class="s2">&quot;Moneylender&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Copper&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="s2">&quot;Mine&quot;</span>
    <span class="s2">&quot;Coppersmith&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Copper&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">4</span>
    <span class="s2">&quot;Rabble&quot;</span>
    <span class="s2">&quot;Smithy&quot;</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">3</span>
    <span class="s2">&quot;Council Room&quot;</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">5</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">4</span>
    <span class="s2">&quot;Courtyard&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s2">&quot;Merchant Ship&quot;</span>
    <span class="s2">&quot;Baron&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Estate&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="s2">&quot;Monument&quot;</span>
    <span class="s2">&quot;Remake&quot;</span>   <span class="c1"># has a low priority so it&#39;ll mostly be played early in the game</span>
    <span class="s2">&quot;Adventurer&quot;</span>
    <span class="s2">&quot;Harvest&quot;</span>
    <span class="s2">&quot;Explorer&quot;</span>
    <span class="s2">&quot;Woodcutter&quot;</span>
    <span class="s2">&quot;Chancellor&quot;</span>
    <span class="s2">&quot;Counting House&quot;</span>
    <span class="s2">&quot;Coppersmith&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Copper&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Outpost&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">extraturn</span> <span class="o">==</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Play an Ambassador if our hand has something we'd want to discard.</p>

<p>Here the AI has to refer to itself indirectly, as <code>my.ai</code>. <code>this</code>
actually has the wrong value right now because JavaScript is weird.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Ambassador&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="s2">&quot;Trading Post&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">+</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Silver&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Chapel&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="s2">&quot;Trade Route&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="s2">&quot;Mint&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s1">&#39;mint&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">)</span>
    <span class="s2">&quot;Bureaucrat&quot;</span>
    <span class="s2">&quot;Conspirator&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&lt;</span> <span class="mi">2</span>
    <span class="s2">&quot;Herbalist&quot;</span>
    <span class="s2">&quot;Moat&quot;</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">6</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">5</span>
    <span class="s2">&quot;Ironworks&quot;</span> <span class="c1"># should have higher priority if condition can see it will gain an Action card</span>
    <span class="s2">&quot;Workshop&quot;</span>
    <span class="s2">&quot;Smugglers&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">smugglerChoices</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Coppersmith&quot;</span>
    <span class="s2">&quot;Library&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">7</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Eighth priority: cards that have become useless. Maybe they'll decrease
the cost of Peddler, trigger Conspirator, or something.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Treasure Map&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Gold&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="o">and</span> <span class="nx">state</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Treasure Map&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="s2">&quot;Shanty Town&quot;</span>
    <span class="s2">&quot;Chapel&quot;</span>
    <span class="s2">&quot;Library&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Ninth priority: Conspirator when +actions remain.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Conspirator&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>At this point, we take no action if that choice is available.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Nope, something is forcing us to take an action.</p>

<p>Last priority: cards that are actively harmful to play at this point,
in order of increasing badness.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Watchtower&quot;</span>
    <span class="s2">&quot;Trade Route&quot;</span>
    <span class="s2">&quot;Treasure Map&quot;</span>
    <span class="s2">&quot;Ambassador&quot;</span>
  <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Most of the order of <code>treasurePriority</code> has no effect on gameplay. The
important part is that Bank and Horn of Plenty are last.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">treasurePriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Platinum&quot;</span>
    <span class="s2">&quot;Diadem&quot;</span>
    <span class="s2">&quot;Philosopher&#39;s Stone&quot;</span>
    <span class="s2">&quot;Gold&quot;</span>
    <span class="s2">&quot;Hoard&quot;</span>
    <span class="s2">&quot;Royal Seal&quot;</span>
    <span class="s2">&quot;Harem&quot;</span>
    <span class="s2">&quot;Venture&quot;</span>
    <span class="s2">&quot;Silver&quot;</span>
    <span class="s2">&quot;Quarry&quot;</span>
    <span class="s2">&quot;Copper&quot;</span>
    <span class="s2">&quot;Potion&quot;</span>
    <span class="s2">&quot;Bank&quot;</span>
    <span class="s2">&quot;Horn of Plenty&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">numUniqueCardsInPlay</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">2</span>
  <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p><code>chooseOrderOnDeck</code> handles situations where multiple cards are returned
to the deck, such as Scout and Apothecary.</p>

<p>This decision doesn't fit into the xPriority / xValue framework, as there
are a number of mostly indistinguishable choices. Instead of listing all
the permutations of cards as choices, we just list the cards to arrange.</p>

<p>The default decision is to put the cards with the lowest discard value on
top.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseOrderOnDeck: </span><span class="nf">(state, cards, my) -&gt;</span>
    <span class="nv">sorter = </span><span class="nf">(card1, card2) -&gt;</span>
      <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card1</span><span class="p">)</span><span class="o">\</span>
      <span class="o">-</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;discard&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card2</span><span class="p">)</span>
    
    <span class="nv">choice = </span><span class="nx">cards</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">choice</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">sorter</span><span class="p">)</span>

  <span class="nv">mintValue: </span><span class="nf">(state, card, my) -&gt;</span> </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Mint anything but coppers. Otherwise, go mostly by the card's base cost.
Diadems are comparable to the cost-5 treasures.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">card</span> <span class="o">is</span> <span class="s1">&#39;Diadem&#39;</span>
      <span class="k">return</span> <span class="mi">4</span>
    <span class="k">return</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span> <span class="o">-</span> <span class="mi">1</span>
  </pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>The default <code>discardPriority</code> is tuned for Big Money where the decisions
are obvious. But many strategies would probably prefer a different
priority list, especially one that knows about action cards.</p>

<p>It doesn't understand
discarding cards to make Shanty Town or Menagerie work, for example.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">discardPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Vineyard&quot;</span>
    <span class="s2">&quot;Colony&quot;</span>
    <span class="s2">&quot;Duke&quot;</span>
    <span class="s2">&quot;Duchy&quot;</span>
    <span class="s2">&quot;Gardens&quot;</span>
    <span class="s2">&quot;Province&quot;</span>  <span class="c1"># Provinces are occasionally useful in hand</span>
    <span class="s2">&quot;Curse&quot;</span>
    <span class="s2">&quot;Estate&quot;</span>
  <span class="p">]</span>

  <span class="nv">discardValue: </span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>If we can discard excess actions, do so. Otherwise, discard the cheapest
cards. Victory cards would already have been discarded by discardPriority.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">actions</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actionBalance</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="mi">20</span> <span class="o">-</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span>
    <span class="k">else</span>
      <span class="mi">0</span> <span class="o">-</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span>
  </pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Putting a card back on the deck (from hand) uses the same preference order as
discarding.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">putOnDeckPriority: </span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">discardPriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>

  <span class="nv">putOnDeckValue: </span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">discardValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>The <code>herbalist</code> decision puts a treasure card back on the deck. It sounds
the same as <code>putOnDeck</code>, but it's for a different
situation -- the card is coming from in play, not from your hand. So
actually we use the <code>mintValue</code> by default.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">herbalistValue: </span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mintValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>

  <span class="nv">trashPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Curse&quot;</span>
    <span class="s2">&quot;Estate&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">4</span>
    <span class="s2">&quot;Copper&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">4</span>
    <span class="s2">&quot;Potion&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">turnsTaken</span> <span class="o">&gt;=</span> <span class="mi">10</span>
    <span class="s2">&quot;Estate&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2</span>
  <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>If we have to trash a card we don't want to, assign a value to each card.
By default, we want to trash the card with the lowest (cost + VP).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">trashValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="mi">0</span> <span class="o">-</span> <span class="nx">card</span><span class="p">.</span><span class="nx">vp</span> <span class="o">-</span> <span class="nx">card</span><span class="p">.</span><span class="nx">cost</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>When presented with a card with simple but variable benefits, such as
Nobles, this is the default way for an AI to decide which benefit it wants.
This function should actually handle a number of common situations.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">benefitValue: </span><span class="nf">(state, choice, my) -&gt;</span>
    <span class="nv">buyValue = </span><span class="mi">1</span>
    <span class="nv">cardValue = </span><span class="mi">2</span>
    <span class="nv">coinValue = </span><span class="mi">3</span>
    <span class="nv">trashValue = </span><span class="mi">4</span>      <span class="c1"># if there are cards we want to trash</span>
    <span class="nv">actionValue = </span><span class="mi">10</span>    <span class="c1"># if we need more actions</span>

    <span class="nv">actionBalance = </span><span class="nx">my</span><span class="p">.</span><span class="nx">actionBalance</span><span class="p">()</span>
    <span class="nv">usableActions = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">actionBalance</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">actionBalance</span> <span class="o">&gt;=</span> <span class="mi">1</span>
      <span class="nx">cardValue</span> <span class="o">+=</span> <span class="nx">actionBalance</span>
    <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">trash</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">trashValue = </span><span class="o">-</span><span class="mi">4</span>
    
    <span class="nv">value = </span><span class="nx">cardValue</span> <span class="o">*</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">cards</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">value</span> <span class="o">+=</span> <span class="nx">coinValue</span> <span class="o">*</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">coins</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">value</span> <span class="o">+=</span> <span class="nx">buyValue</span> <span class="o">*</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">buys</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">value</span> <span class="o">+=</span> <span class="nx">trashValue</span> <span class="o">*</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">trash</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">value</span> <span class="o">+=</span> <span class="nx">actionValue</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">((</span><span class="nx">choice</span><span class="p">.</span><span class="nx">actions</span> <span class="o">?</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">usableActions</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>state.log("Benefit: #{JSON.stringify(choice)} / Value: #{value} / wants to trash: #{my.ai.wantsToTrash(state)}")</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">value</span>
    </pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p><code>ambassadorPriority</code> chooses a card to Ambassador and how many of it to
return.</p>

<p>These choices may look odd: remember that choices are evaluated as strings.
So if we return lists, they won't match any of the choices. We need to
return their joined string versions.</p>

<p>This is a moderately acceptable way to deal with the fact that, in
JavaScript, lists are never "equal" to other lists anyway.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ambassadorPriority: </span><span class="nf">(state, my) -&gt;</span>
    <span class="p">[</span>
      <span class="s2">&quot;Curse,2&quot;</span>
      <span class="s2">&quot;Curse,1&quot;</span>
      <span class="s2">&quot;Curse,0&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Handle a silly case:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="s2">&quot;Ambassador,2&quot;</span>
      <span class="s2">&quot;Estate,2&quot;</span>
      <span class="s2">&quot;Estate,1&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Make sure we have at least $5 in the deck, including if we buy a Silver.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="s2">&quot;Copper,2&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span>
      <span class="s2">&quot;Copper,2&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span>
      <span class="s2">&quot;Copper,2&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">7</span>
      <span class="s2">&quot;Copper,1&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">4</span>
      <span class="s2">&quot;Copper,1&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">4</span>
      <span class="s2">&quot;Estate,0&quot;</span>
      <span class="s2">&quot;Copper,0&quot;</span>
    <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Taking into account gain priorities, gain values, trash priorities, and
trash values, how much do we like having this card in our deck overall?</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">cardInDeckValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="nv">endgamePower = </span><span class="mi">1</span>
    </pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Are we in the late game? If so, we care much more about getting cards
at the top of our priority order.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">5</span>
      <span class="nv">endgamePower = </span><span class="mi">3</span>

    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;trash&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">))</span> <span class="o">+</span> <span class="o">\</span>
           <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">choiceToValue</span><span class="p">(</span><span class="s1">&#39;gain&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">card</span><span class="p">),</span> <span class="nx">endgamePower</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>upgradeValue measures the benefit of choices on Remodel, Upgrade,
and so on, where you exchange one card for a better one.</p>

<p>So here's a really basic thing that might work.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">upgradeValue: </span><span class="nf">(state, choice, my) -&gt;</span>
    <span class="p">[</span><span class="nx">oldCard</span><span class="p">,</span> <span class="nx">newCard</span><span class="p">]</span> <span class="o">=</span> <span class="nx">choice</span>
    <span class="k">return</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">cardInDeckValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">newCard</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="o">-</span> <span class="o">\</span>
           <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">cardInDeckValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">oldCard</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>The question here is: do you want to discard an Estate using a Baron?
And the answer is yes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">baronDiscardPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span><span class="kc">yes</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p><code>wishValue</code> prefers to wish for the card its draw pile contains
the most of.</p>

<p>The fact that this doesn't make a hypothetical copy is a shortcut. We are
technically "peeking" at the deck, but we don't use any information except
the count of each card, which would be the same in any hypothetical version.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">wishValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="nv">pile = </span><span class="nx">my</span><span class="p">.</span><span class="nx">draw</span>
    <span class="k">if</span> <span class="nx">pile</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="nv">pile = </span><span class="nx">my</span><span class="p">.</span><span class="nx">discard</span>
    <span class="k">return</span> <span class="nx">countInList</span><span class="p">(</span><span class="nx">pile</span><span class="p">,</span> <span class="nx">card</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Prefer to gain action and treasure cards on the deck. Give other cards
a value of -1 so that <code>null</code> is a better choice.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">gainOnDeckValue: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">or</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span><span class="p">)</span>
      <span class="mi">1</span>
    <span class="k">else</span>
      <span class="o">-</span><span class="mi">1</span>
  </pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>How much does the AI want to discard its deck right now (for Chancellor)?
Here, we decide to reshuffle (returning a reshuffleValue over 0) when most
of the non-Action, non-Treasure cards are in the draw pile, or when there
are no such cards in the deck.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">reshuffleValue: </span><span class="nf">(state, choice, my) -&gt;</span>
    <span class="nv">junkToDraw = </span><span class="mi">0</span>
    <span class="nv">totalJunk = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">draw</span>
      <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">or</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span><span class="p">)</span>
        <span class="nx">junkToDraw</span><span class="o">++</span>
    <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getDeck</span><span class="p">()</span>
      <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">or</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span><span class="p">)</span>
        <span class="nx">totalJunk</span><span class="o">++</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nx">totalJunk</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">proportion = </span><span class="nx">junkToDraw</span><span class="err">/totalJunk</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">proportion</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Choose to discard or to gain a curse when attacked by Torturer.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">torturerPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;curse&#39;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">countInSupply</span><span class="p">(</span><span class="s2">&quot;Curse&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="s1">&#39;discard&#39;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToDiscard</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="s1">&#39;discard&#39;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="s1">&#39;curse&#39;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">trashingInHand</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s1">&#39;curse&#39;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">3</span>
    <span class="s1">&#39;discard&#39;</span>
    <span class="s1">&#39;curse&#39;</span>
  <span class="p">]</span>

  <span class="nv">librarySetAsideValue: </span><span class="nf">(state, card, my) -&gt;</span> <span class="p">[</span>
    <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span>
      <span class="mi">1</span>
    <span class="k">else</span>
      <span class="o">-</span><span class="mi">1</span>
  <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <h3>Informational methods</h3>

<p><code>wantsToTrash</code> returns the number of cards in hand that we would trash
for no benefit.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">wantsToTrash: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">trashableCards = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span>
      <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">chooseTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="p">[</span><span class="nx">card</span><span class="p">,</span> <span class="kc">null</span><span class="p">])</span> <span class="o">is</span> <span class="nx">card</span>
        <span class="nx">trashableCards</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">trashableCards</span>
  </pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p><code>wantsToDiscard</code> returns the number of cards in hand that we would
freely discard.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">wantsToDiscard: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">discardableCards = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span>
      <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">chooseDiscard</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="p">[</span><span class="nx">card</span><span class="p">,</span> <span class="kc">null</span><span class="p">])</span> <span class="o">is</span> <span class="nx">card</span>
        <span class="nx">discardableCards</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">discardableCards</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p><code>pessimisticMoneyInHand</code> establishes a minimum on how much money the
player will be able to spend in this game state. It assumes the player
will draw no money from the deck.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pessimisticMoneyInHand: </span><span class="nf">(state) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Don't recurse more than once. If we're already in a hypothetical
situation, use the stupid version instead.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">depth</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">).</span><span class="nx">getAvailableMoney</span><span class="p">()</span>

    <span class="nv">buyPhase = </span><span class="k">this</span><span class="p">.</span><span class="nx">pessimisticBuyPhase</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">buyPhase</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">coins</span>
  </pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Look ahead to the buy phase, assuming we draw no money from the deck.</p>

<p>TODO: when we can handle known cards on top of the deck, take them
into account.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pessimisticBuyPhase: </span><span class="nf">(state) -&gt;</span>
    <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">depth</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>A last-ditch effort to avoid recursion, by simply fast-forwarding
to the next phase.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">phase</span> <span class="o">==</span> <span class="s1">&#39;action&#39;</span>
        <span class="nv">state.phase = </span><span class="s1">&#39;treasure&#39;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">phase</span> <span class="o">==</span> <span class="s1">&#39;treasure&#39;</span>
        <span class="nv">state.phase = </span><span class="s1">&#39;buy&#39;</span>

    <span class="p">[</span><span class="nx">hypothesis</span><span class="p">,</span> <span class="nx">hypothetically_my</span><span class="p">]</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">hypothetical</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="nv">hypothetically_my.draw = </span><span class="p">[]</span>
    <span class="nv">hypothetically_my.discard = </span><span class="p">[]</span>
    
    <span class="k">while</span> <span class="nx">hypothesis</span><span class="p">.</span><span class="nx">phase</span> <span class="o">!=</span> <span class="s1">&#39;buy&#39;</span>
      <span class="nx">hypothesis</span><span class="p">.</span><span class="nx">doPlay</span><span class="p">()</span>

    <span class="k">return</span> <span class="nx">hypothesis</span>
  
  <span class="nv">pessimisticCardsGained: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">newState = </span><span class="k">this</span><span class="p">.</span><span class="nx">pessimisticBuyPhase</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nx">newState</span><span class="p">.</span><span class="nx">doPlay</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">newState</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">gainedThisTurn</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <h3>Utility methods</h3>

<p><code>copy</code> makes a copy of the AI. It will have the same behavior but a
different name, and will not be equal to this AI.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copy: </span><span class="nf">() -&gt;</span>
    <span class="nv">ai = </span><span class="k">new</span> <span class="nx">BasicAI</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="k">this</span>
      <span class="nx">ai</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="nv">ai.name = </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39;*&#39;</span>
    <span class="nx">ai</span>

  <span class="nv">toString: </span><span class="nf">() -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span>
<span class="k">this</span><span class="p">.</span><span class="nv">BasicAI = </span><span class="nx">BasicAI</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <h2>Utility functions</h2>

<p><code>count</code> counts the number of times <code>elt</code> appears in <code>list</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">countInList = </span><span class="nf">(list, elt) -&gt;</span>
  <span class="nv">count = </span><span class="mi">0</span>
  <span class="k">for</span> <span class="nx">member</span> <span class="k">in</span> <span class="nx">list</span>
    <span class="k">if</span> <span class="nx">member</span> <span class="o">==</span> <span class="nx">elt</span>
      <span class="nx">count</span><span class="o">++</span>
  <span class="nx">count</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p><code>stringify</code> turns an object into a string, while handling <code>null</code> safely.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">stringify = </span><span class="nf">(obj) -&gt;</span>
  <span class="k">if</span> <span class="nx">obj</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="k">return</span> <span class="kc">null</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 