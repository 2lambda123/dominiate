<!DOCTYPE html>  <html> <head>   <title>basicAI.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="basicAI.html">                 basicAI.coffee               </a>                                           <a class="source" href="cards.html">                 cards.coffee               </a>                                           <a class="source" href="compileStrategies.html">                 compileStrategies.coffee               </a>                                           <a class="source" href="gameState.html">                 gameState.coffee               </a>                                           <a class="source" href="heuristics.html">                 heuristics.coffee               </a>                                           <a class="source" href="play.html">                 play.coffee               </a>                                           <a class="source" href="playWeb.html">                 playWeb.coffee               </a>                                           <a class="source" href="testSimulation.html">                 testSimulation.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               basicAI.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>The Basic AI</h2>

<p>This class defines a rule-based AI of the kind that is popular
for evaluating Dominion strategies. It can be subclassed -- or simply
have its methods overwritten on an instance -- to play new strategies.</p>

<p>Every time the player needs to make a meaningful decision, a method called
<code>chooseX</code> (for some X) will be called on the AI, which can examine the game
state and make a decision accordingly.</p>

<p>In any case that is not a simple yes/no decision, the method will be 
given a list of choices. It will delegate to the <code>xValue</code> method to assign a
value to each possible choice, and choose the one with the highest value
(earlier options win ties).</p>

<p>If the <code>xValue</code> method does not exist (as will often be the case), it will
try a different method called <code>xPriority</code>, which takes in the state and
returns an ordered list of choices. The player will make the first valid
choice in that list. Priority functions are usually easier to define than
value functions.</p>

<p>The BasicAI has a default decision function for every decision, so
every AI that derives from it will have <em>some</em> way to decide what to do in
any situation. However, when defining an AI, you will often want to override
some of these decision functions.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">BasicAI</span>
  <span class="nv">name: </span><span class="s1">&#39;Basic AI&#39;</span>
  <span class="nv">author: </span><span class="s1">&#39;rspeer&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Referring to <code>state.current</code> to find information about one's own state is
not always safe! Some of these decisions may be made during other players'
turns. In those cases, what we want is <code>this.myPlayer(state)</code>.</p>

<p>This is passed in as an argument <code>my</code> to the decision functions, because
it's convenient and it creates nice idioms such as <code>my.hand</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">myPlayer: </span><span class="nf">(state) -&gt;</span>
    <span class="k">for</span> <span class="nx">player</span> <span class="k">in</span> <span class="nx">state</span><span class="p">.</span><span class="nx">players</span>
      <span class="k">if</span> <span class="nx">player</span><span class="p">.</span><span class="nx">ai</span> <span class="o">is</span> <span class="k">this</span>
        <span class="k">return</span> <span class="nx">player</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;#{this} is being asked to make a decision, but isn&#39;t playing the game...?&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Given a game state, a list of possible choices, and a function
that returns a preference order, make the best choice in that
preference order.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">choosePriority: </span><span class="nf">(state, choices, priorityfunc) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">priority = </span><span class="nx">priorityfunc</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
    <span class="nv">bestChoice = </span><span class="kc">null</span>
    <span class="nv">bestIndex = </span><span class="kc">null</span>
    <span class="k">for</span> <span class="nx">choice</span> <span class="k">in</span> <span class="nx">choices</span>
      <span class="nv">index = </span><span class="nx">priority</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">choice</span><span class="p">))</span>
      <span class="k">if</span> <span class="nx">index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">and</span> <span class="p">(</span><span class="nx">bestIndex</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">or</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">bestIndex</span><span class="p">)</span>
        <span class="nv">bestIndex = </span><span class="nx">index</span>
        <span class="nv">bestChoice = </span><span class="nx">choice</span>
    <span class="k">if</span> <span class="nx">bestChoice</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">and</span> <span class="kc">null</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">choices</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The AI chose <code>null</code> when it wasn't in the list of choices.
That means either no choices are available, or this AI is being
forced to make a decision it's not prepared for.</p>

<p>In that case, if there are any choices, it will arbitrarily choose
the first one. If there are no choices, then choosing nothing becomes
the one legal choice, so it chooses that.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">?</span> <span class="kc">null</span>
    <span class="k">return</span> <span class="nx">bestChoice</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Given a game state, a list of possible choices, and a function that
returns a <em>value</em> for each choice, make the highest-valued choice.</p>

<p>The null choice has value 0 when it is available, so negative-valued
choices will be avoided.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseValue: </span><span class="nf">(state, choices, valuefunc) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">bestChoice = </span><span class="kc">null</span>
    <span class="nv">bestValue = </span><span class="o">-</span><span class="kc">Infinity</span>
    <span class="k">for</span> <span class="nx">choice</span> <span class="k">in</span> <span class="nx">choices</span>
      <span class="k">if</span> <span class="nx">choice</span> <span class="o">is</span> <span class="kc">null</span>
        <span class="nv">value = </span><span class="mi">0</span>
      <span class="k">else</span>
        <span class="nv">value = </span><span class="nx">valuefunc</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">bestValue</span>
        <span class="nv">bestValue = </span><span class="nx">value</span>
        <span class="nv">bestChoice = </span><span class="nx">choice</span>
    <span class="k">if</span> <span class="nx">bestChoice</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">and</span> <span class="kc">null</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">choices</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>This should only happen when there are no choices, but to be sure,
we check if there is a <code>choices[0]</code> and choose it if so.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">?</span> <span class="kc">null</span>
    <span class="k">if</span> <span class="nx">bestChoice</span> <span class="o">is</span> <span class="kc">undefined</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;undefined choice from #{choices}&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">bestChoice</span>
  </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>Decisions</h2>

<h3>Common decisions</h3>

<p>These are decisions each AI has to make on most turns.</p>

<p>These delegate to the <code>...Value</code> or <code>...Priority</code> functions, as described.
You could override these functions directly, but that will probably make
your AI code unnecessarily complicated.</p>

<p><code>chooseAction</code>: choose an action card from the hand to play.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseAction: </span><span class="nf">(state, choices) -&gt;</span>
    <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">actionValue</span><span class="o">?</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">chooseValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">actionValue</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">choosePriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">actionPriority</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><code>chooseTreasure</code>: choose a treasure card from the hand to play.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseTreasure: </span><span class="nf">(state, choices) -&gt;</span>
    <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">treasureValue</span><span class="o">?</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">chooseValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">treasureValue</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">choosePriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">treasurePriority</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p><code>chooseGain</code>: choose a card to gain (possibly in the buy phase, or possibly
as a card effect). The AI is allowed to assume it is the current player,
so this can't be used for Saboteur.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseGain: </span><span class="nf">(state, choices) -&gt;</span>
    <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">gainValue</span><span class="o">?</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">chooseValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">gainValue</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">choosePriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">gainPriority</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p><code>chooseDiscard</code>: choose a card to discard. Discards that are ranked 
higher than <code>null</code> will be discarded voluntarily on cards such as Cellar.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseDiscard: </span><span class="nf">(state, choices) -&gt;</span>
    <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">discardValue</span><span class="o">?</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">chooseValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">discardValue</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">choosePriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">discardPriority</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><code>chooseTrash</code>: choose a card to trash (for no further effect).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseTrash: </span><span class="nf">(state, choices) -&gt;</span>
    <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">trashValue</span><span class="o">?</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">chooseValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">trashValue</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">choosePriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">trashPriority</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Decisions for specific action cards</h3>

<p><code>chooseAmbassador</code> chooses from a list of two-item arrays of
[card, quantity], selecting the card to ambassador and the number to
return to the supply.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseAmbassador: </span><span class="nf">(state, choices) -&gt;</span>
    <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">ambassadorValue</span><span class="o">?</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">chooseValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">ambassadorValue</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">choosePriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">ambassadorPriority</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>The question <code>chooseBaronDiscard</code> asks is: do you want to discard an
Estate for +$4, rather than gain an Estate? And the answer is almost
certainly yes.</p>

<p>An AI can replace this function directly to make a different
decision.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseBaronDiscard: </span><span class="nf">(state) -&gt;</span> <span class="kc">yes</span>
  </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p><code>chooseWish</code> asks which card to wish for using the Wishing Well.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseWish: </span><span class="nf">(state, choices) -&gt;</span>
    <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">wishValue</span><span class="o">?</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">chooseValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wishValue</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">wishPriority</span><span class="o">?</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">choosePriority</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wishPriority</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">chooseValue</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wishValueDefault</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><code>chooseToGainOnDeck</code> takes in a card that is being gained, and decides
if it wants it on the deck instead of the discard pile, returning a
yes/no answer.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseToGainOnDeck: </span><span class="nf">(state, card) -&gt;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">isAction</span> <span class="o">or</span> <span class="nx">card</span><span class="p">.</span><span class="nx">isTreasure</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h2>Default strategies</h2>

<p>The default buying strategy is a form of Big Money that has, by now,
been beaten by the newer one in BigMoney.coffee.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">gainPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Colony&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Platinum&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="s2">&quot;Province&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">countInSupply</span><span class="p">(</span><span class="s2">&quot;Colony&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">6</span>
    <span class="s2">&quot;Duchy&quot;</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">5</span>
    <span class="s2">&quot;Estate&quot;</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Platinum&quot;</span>
    <span class="s2">&quot;Gold&quot;</span>
    <span class="s2">&quot;Silver&quot;</span>
    <span class="s2">&quot;Copper&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">3</span>
    <span class="kc">null</span>
  <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>The default action-playing strategy, which aims to include a usable plan
for playing every action card, so that most AIs don't need to override it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">actionPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>First priority: cards that succeed if we play them now, and might
not if we play them later.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Menagerie&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">menagerieDraws</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="s2">&quot;Shanty Town&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">shantyTownDraws</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="s2">&quot;Tournament&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Province&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Second priority: cards that give +2 actions.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Trusty Steed&quot;</span>
    <span class="s2">&quot;Festival&quot;</span>
    <span class="s2">&quot;University&quot;</span>
    <span class="s2">&quot;Farming Village&quot;</span>
    <span class="s2">&quot;Bazaar&quot;</span>
    <span class="s2">&quot;Worker&#39;s Village&quot;</span>
    <span class="s2">&quot;City&quot;</span>
    <span class="s2">&quot;Walled Village&quot;</span>
    <span class="s2">&quot;Fishing Village&quot;</span>
    <span class="s2">&quot;Village&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Third priority: cards that give +1 action and are almost always good.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Bag of Gold&quot;</span>
    <span class="s2">&quot;Grand Market&quot;</span>
    <span class="s2">&quot;Hunting Party&quot;</span>
    <span class="s2">&quot;Alchemist&quot;</span>
    <span class="s2">&quot;Laboratory&quot;</span>
    <span class="s2">&quot;Caravan&quot;</span>
    <span class="s2">&quot;Market&quot;</span>
    <span class="s2">&quot;Peddler&quot;</span>
    <span class="s2">&quot;Conspirator&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">inPlay</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Great Hall&quot;</span>
    <span class="s2">&quot;Wishing Well&quot;</span>
    <span class="s2">&quot;Lighthouse&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Fourth priority: terminal card-drawers, if we have actions to spare.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Smithy&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">4</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Fifth priority: card-cycling that might improve the hand.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Familiar&quot;</span> <span class="c1"># after other non-terminals in case non-terminal draws KC/TR</span>
    <span class="s2">&quot;Pawn&quot;</span>
    <span class="s2">&quot;Warehouse&quot;</span>
    <span class="s2">&quot;Cellar&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Sixth priority: non-terminal cards that don't succeed but at least
give us something.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Tournament&quot;</span>
    <span class="s2">&quot;Menagerie&quot;</span>
    <span class="s2">&quot;Shanty Town&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">actions</span> <span class="o">==</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Seventh priority: terminals. Of course, Nobles might be a non-terminal
if we decide we need the actions more than the cards.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Nobles&quot;</span>
    <span class="s2">&quot;Treasure Map&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Treasure Map&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Followers&quot;</span>
    <span class="s2">&quot;Mountebank&quot;</span>
    <span class="s2">&quot;Witch&quot;</span>
    <span class="s2">&quot;Sea Hag&quot;</span>
    <span class="s2">&quot;Tribute&quot;</span> <span class="c1"># after Cursers but before other terminals, there is probably a better spot for it</span>
    <span class="s2">&quot;Goons&quot;</span>
    <span class="s2">&quot;Wharf&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Tactician needs a play condition, but I don't know what it would be.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Tactician&quot;</span>
    <span class="s2">&quot;Militia&quot;</span>
    <span class="s2">&quot;Princess&quot;</span>
    <span class="s2">&quot;Explorer&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Province&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="s2">&quot;Steward&quot;</span>
    <span class="s2">&quot;Moneylender&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Copper&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="s2">&quot;Bridge&quot;</span>
    <span class="s2">&quot;Horse Traders&quot;</span>
    <span class="s2">&quot;Coppersmith&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Copper&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">3</span>
    <span class="s2">&quot;Smithy&quot;</span>
    <span class="s2">&quot;Council Room&quot;</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">4</span>
    <span class="s2">&quot;Merchant Ship&quot;</span>
    <span class="s2">&quot;Baron&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Estate&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="s2">&quot;Monument&quot;</span>
    <span class="s2">&quot;Adventurer&quot;</span>
    <span class="s2">&quot;Harvest&quot;</span>
    <span class="s2">&quot;Explorer&quot;</span>
    <span class="s2">&quot;Woodcutter&quot;</span>
    <span class="s2">&quot;Coppersmith&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Copper&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Play an Ambassador if our hand has something we'd want to discard.</p>

<p>Here the AI has to refer to itself indirectly, as <code>my.ai</code>. <code>this</code>
actually has the wrong value right now because JavaScript is weird.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Ambassador&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="s2">&quot;Trading Post&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">+</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInHand</span><span class="p">(</span><span class="s2">&quot;Silver&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="s2">&quot;Chapel&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="s2">&quot;Trade Route&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ai</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="s2">&quot;Conspirator&quot;</span>
    <span class="s2">&quot;Moat&quot;</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">5</span>
    <span class="s2">&quot;Ironworks&quot;</span> <span class="c1"># should have higher priority if condition can see it will gain an Action card</span>
    <span class="s2">&quot;Workshop&quot;</span>
    <span class="s2">&quot;Coppersmith&quot;</span>
    <span class="s2">&quot;Watchtower&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">6</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Eighth priority: cards that have become useless. Maybe they'll decrease
the cost of Peddler or something.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Treasure Map&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Gold&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="o">and</span> <span class="nx">state</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">countInDeck</span><span class="p">(</span><span class="s2">&quot;Treasure Map&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="s2">&quot;Shanty Town&quot;</span>
    <span class="s2">&quot;Chapel&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>At this point, we take no action if that choice is available.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Nope, something is forcing us to take an action.</p>

<p>Last priority: cards that are actively harmful to play at this point,
in order of increasing badness.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Watchtower&quot;</span>
    <span class="s2">&quot;Trade Route&quot;</span>
    <span class="s2">&quot;Treasure Map&quot;</span>
    <span class="s2">&quot;Ambassador&quot;</span>
  <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Most of the order of <code>treasurePriority</code> has no effect on gameplay. The
important part is that Bank and Horn of Plenty are last.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">treasurePriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Platinum&quot;</span>
    <span class="s2">&quot;Diadem&quot;</span>
    <span class="s2">&quot;Philosopher&#39;s Stone&quot;</span>
    <span class="s2">&quot;Gold&quot;</span>
    <span class="s2">&quot;Harem&quot;</span>
    <span class="s2">&quot;Venture&quot;</span>
    <span class="s2">&quot;Silver&quot;</span>
    <span class="s2">&quot;Quarry&quot;</span>
    <span class="s2">&quot;Copper&quot;</span>
    <span class="s2">&quot;Potion&quot;</span>
    <span class="s2">&quot;Bank&quot;</span>
    <span class="s2">&quot;Horn of Plenty&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">numUniqueCardsInPlay</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="kc">null</span>
  <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>The default <code>discardPriority</code> is tuned for Big Money where the decisions
are obvious. But many strategies would probably prefer a different
priority list, especially one that knows about action cards.</p>

<p>It doesn't understand
discarding cards to make Shanty Town or Menagerie work, for example, and
It doesn't recognize when dead terminal actions would be good to discard.
Defining that may require a <code>discardValue</code> function.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">discardPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Vineyard&quot;</span>
    <span class="s2">&quot;Colony&quot;</span>
    <span class="s2">&quot;Duchy&quot;</span>
    <span class="s2">&quot;Gardens&quot;</span>
    <span class="s2">&quot;Province&quot;</span>  <span class="c1"># Provinces are occasionally useful in hand</span>
    <span class="s2">&quot;Curse&quot;</span>
    <span class="s2">&quot;Estate&quot;</span>
    <span class="s2">&quot;Copper&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>The above cards are the only ones that will be discarded in Cellar.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>At this point, we're being forced to discard. Hopefully we can discard
a Silver...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Silver&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Nope. We've got other cards and the strategy hasn't dealt with how to
discard them. Pick the first option and hope.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Like the <code>discardPriority</code>, the default <code>trashPriority</code> is sufficient for
Big Money but won't be able to handle tough decisions for other
strategies.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">trashPriority: </span><span class="nf">(state, my) -&gt;</span> <span class="p">[</span>
    <span class="s2">&quot;Curse&quot;</span>
    <span class="s2">&quot;Estate&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">4</span>
    <span class="s2">&quot;Copper&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">4</span>
    <span class="s2">&quot;Potion&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">turnsTaken</span> <span class="o">&gt;=</span> <span class="mi">10</span>
    <span class="s2">&quot;Estate&quot;</span> <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">gainsToEndGame</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2</span>
    <span class="kc">null</span>
    <span class="s2">&quot;Copper&quot;</span>
    <span class="s2">&quot;Potion&quot;</span>
    <span class="s2">&quot;Estate&quot;</span>
    <span class="s2">&quot;Silver&quot;</span>
  <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>When presented with a card with simple but variable benefits, such as
Nobles, this is the default way for an AI to decide which benefit it wants.
This function should actually handle a number of common situations.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">chooseBenefit: </span><span class="nf">(state, choices) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">buyValue = </span><span class="mi">1</span>
    <span class="nv">cardValue = </span><span class="mi">2</span>
    <span class="nv">coinValue = </span><span class="mi">3</span>
    <span class="nv">trashValue = </span><span class="mi">4</span>      <span class="c1"># if there are cards we want to trash</span>
    <span class="nv">actionValue = </span><span class="mi">10</span>    <span class="c1"># if we need more actions</span>
    <span class="nv">trashableCards = </span><span class="mi">0</span>

    <span class="nv">actionBalance = </span><span class="nx">my</span><span class="p">.</span><span class="nx">actionBalance</span><span class="p">()</span>
    <span class="nv">usableActions = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">actionBalance</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Draw cards if we have a surplus of actions</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">actionBalance</span> <span class="o">&gt;=</span> <span class="mi">1</span>
      <span class="nx">cardValue</span> <span class="o">+=</span> <span class="nx">actionBalance</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>How many cards do we want to trash?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span>
      <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">chooseTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="p">[</span><span class="nx">card</span><span class="p">,</span> <span class="kc">null</span><span class="p">])</span> <span class="o">is</span> <span class="nx">card</span>
        <span class="nx">trashableCards</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="nv">best = </span><span class="kc">null</span>
    <span class="nv">bestValue = </span><span class="o">-</span><span class="mi">1000</span>
    <span class="k">for</span> <span class="nx">choice</span> <span class="k">in</span> <span class="nx">choices</span>
      <span class="nv">value = </span><span class="nx">cardValue</span> <span class="o">*</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">cards</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nx">value</span> <span class="o">+=</span> <span class="nx">coinValue</span> <span class="o">*</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">coins</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nx">value</span> <span class="o">+=</span> <span class="nx">buyValue</span> <span class="o">*</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">buys</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">trashes = </span><span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">trashes</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">trashes</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">wantsToTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
        <span class="nx">value</span> <span class="o">+=</span> <span class="nx">trashValue</span> <span class="o">*</span> <span class="nx">trashes</span>
      <span class="k">else</span>
        <span class="nx">value</span> <span class="o">-=</span> <span class="nx">trashValue</span> <span class="o">*</span> <span class="nx">trashes</span>
      <span class="nx">value</span> <span class="o">+=</span> <span class="nx">actionValue</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">((</span><span class="nx">choice</span><span class="p">.</span><span class="nx">actions</span> <span class="o">?</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">usableActions</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">bestValue</span>
        <span class="nv">best = </span><span class="nx">choice</span>
        <span class="nv">bestValue = </span><span class="nx">value</span>
    <span class="nx">best</span>
  </pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p><code>ambassadorPriority</code> chooses a card to Ambassador and how many of it to
return.</p>

<p>These choices may look odd: remember that choices are evaluated as strings.
So if we return lists, they won't match any of the choices. We need to
return their joined string versions.</p>

<p>This is a moderately acceptable way to deal with the fact that, in
JavaScript, lists are never "equal" to other lists anyway.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ambassadorPriority: </span><span class="nf">(state, my) -&gt;</span>
    <span class="p">[</span>
      <span class="s2">&quot;Curse,2&quot;</span>
      <span class="s2">&quot;Curse,1&quot;</span>
      <span class="s2">&quot;Curse,0&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Handle a silly case:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="s2">&quot;Ambassador,2&quot;</span>
      <span class="s2">&quot;Estate,2&quot;</span>
      <span class="s2">&quot;Estate,1&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Make sure we have at least $5 in the deck, including if we buy a Silver.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="s2">&quot;Copper,2&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span>
      <span class="s2">&quot;Copper,2&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span>
      <span class="s2">&quot;Copper,2&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">7</span>
      <span class="s2">&quot;Copper,1&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">and</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTotalMoney</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">4</span>
      <span class="s2">&quot;Copper,1&quot;</span> <span class="k">if</span> <span class="nx">my</span><span class="p">.</span><span class="nx">getTreasureInHand</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">4</span>
      <span class="s2">&quot;Estate,0&quot;</span>
      <span class="s2">&quot;Copper,0&quot;</span>
    <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p><code>wishValueDefault()</code> prefers to wish for the card its draw pile contains
the most of.</p>

<p>The fact that this doesn't make a hypothetical copy is a shortcut. We are
technically "peeking" at the deck, but we don't use any information except
the count of each card, which would be the same in any hypothetical version.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">wishValueDefault: </span><span class="nf">(state, card, my) -&gt;</span>
    <span class="nv">pile = </span><span class="nx">my</span><span class="p">.</span><span class="nx">draw</span>
    <span class="k">if</span> <span class="nx">pile</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="nv">pile = </span><span class="nx">my</span><span class="p">.</span><span class="nx">discard</span>
    <span class="k">return</span> <span class="nx">countInList</span><span class="p">(</span><span class="nx">pile</span><span class="p">,</span> <span class="nx">card</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <h3>Informational methods</h3>

<p><code>wantsToTrash</code> returns the number of cards in hand that we would trash
for no benefit.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">wantsToTrash: </span><span class="nf">(state) -&gt;</span>
    <span class="nv">my = </span><span class="k">this</span><span class="p">.</span><span class="nx">myPlayer</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nv">trashableCards = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">card</span> <span class="k">in</span> <span class="nx">my</span><span class="p">.</span><span class="nx">hand</span>
      <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">chooseTrash</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="p">[</span><span class="nx">card</span><span class="p">,</span> <span class="kc">null</span><span class="p">])</span> <span class="o">is</span> <span class="nx">card</span>
        <span class="nx">trashableCards</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">trashableCards</span>
  </pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <h3>Utility methods</h3>

<p><code>copy</code> makes a copy of the AI. It will have the same behavior but a
different name, and will not be equal to this AI.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copy: </span><span class="nf">() -&gt;</span>
    <span class="nv">ai = </span><span class="k">new</span> <span class="nx">BasicAI</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="k">this</span>
      <span class="nx">ai</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="nv">ai.name = </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39;*&#39;</span>
    <span class="nx">ai</span>

  <span class="nv">toString: </span><span class="nf">() -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span>
<span class="k">this</span><span class="p">.</span><span class="nv">BasicAI = </span><span class="nx">BasicAI</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <h2>Utility functions</h2>

<p><code>count</code> counts the number of times <code>elt</code> appears in <code>list</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">countInList = </span><span class="nf">(list, elt) -&gt;</span>
  <span class="nv">count = </span><span class="mi">0</span>
  <span class="k">for</span> <span class="nx">member</span> <span class="k">in</span> <span class="nx">list</span>
    <span class="k">if</span> <span class="nx">member</span> <span class="o">==</span> <span class="nx">elt</span>
      <span class="nx">count</span><span class="o">++</span>
  <span class="nx">count</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p><code>stringify</code> turns an object into a string, while handling <code>null</code> safely.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">stringify = </span><span class="nf">(obj) -&gt;</span>
  <span class="k">if</span> <span class="nx">obj</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="k">return</span> <span class="kc">null</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 